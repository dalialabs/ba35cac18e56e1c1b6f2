"use strict";(self.webpackChunkmaia_node=self.webpackChunkmaia_node||[]).push([[605],{91605:(t,e,n)=>{n.r(e),n.d(e,{default:()=>A});n(52675),n(67945),n(84185),n(83851),n(81278),n(79432),n(60825);var a=n(64467),i=n(45458),o=n(80296),s=n(10467),r=n(23029),c=n(92901),l=n(50388),u=n(53954),d=n(15361),p=n(54756),f=n.n(p),h=(n(28706),n(2008),n(51629),n(74423),n(23792),n(62062),n(23288),n(62010),n(26099),n(3362),n(21699),n(47764),n(23500),n(62953),n(81517));function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach(function(e){(0,a.A)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(y=function(){return!!t})()}var m="DaliaNSDataLayer",w="DaliaNSAnalyticsLayer",k="DaliaNSDefault";const A=function(t){function e(t){var n,a,i,o,s=t.document,c=t.data,d=t.clientGaEvents;return(0,r.A)(this,e),a=this,i=e,o=[{document:s}],i=(0,u.A)(i),(n=(0,l.A)(a,y()?Reflect.construct(i,o||[],(0,u.A)(a).constructor):i.apply(a,o))).data=c,n.formModel=c.form,n.clientGaEvents=d,window[m]=window[m]||[],window[w]=window[w]||[],n.gtag("js",new Date),n.gtag("config",n.data.GoogleMeasurementId,{groups:k}),n.initCustomEvents(),n.selfInit(),n}return(0,d.A)(e,t),(0,c.A)(e,[{key:"initCustomEvents",value:function(){var t=this;this.clientGaEvents.forEach(function(e){"gtag"===e.type?t.gtag("config",e.measurementId,{groups:e.group}):"analytics"===e.type&&(t.ga("l",new Date),t.ga("create",e.measurementId,"auto",e.group),t.ga("send","pageview"))})}},{key:"selfInit",value:(g=(0,s.A)(f().mark(function t(){var e,a,i;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,Promise.all([n.e(511).then(n.t.bind(n,8511,23)),this.tryLoadAnalyticsScripts()]);case 1:e=t.sent,a=(0,o.A)(e,1),i=a[0],this.mixpanel=i.default.init(this.data.MixPanelToken,{},"dalia-mixpanel"),this.selfInitDone=!0;case 2:case"end":return t.stop()}},t,this)})),function(){return g.apply(this,arguments)})},{key:"tryLoadAnalyticsScripts",value:(h=(0,s.A)(f().mark(function t(){var e;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("load"!==(e=this.canLoadAnalyticsScripts())){t.next=2;break}return t.next=1,this.loadAnalyticsScripts();case 1:t.next=3;break;case 2:"wait"===e&&this.waitForCookiesConsent();case 3:case"end":return t.stop()}},t,this)})),function(){return h.apply(this,arguments)})},{key:"canLoadAnalyticsScripts",value:function(){var t=this.formModel.config.checkCookiesConsent;if(null!=t&&t.enabled){var e=t.consentAcceptedCookies,n=void 0===e?{}:e,a=t.consentAnsweredCookies,i=this.validateCookies(n);if(!(null!=a?this.validateCookies(a):i))return"wait";if(!i)return"skip"}return"load"}},{key:"loadAnalyticsScripts",value:(p=(0,s.A)(f().mark(function t(){return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,Promise.all([this.loadScript("https://www.googletagmanager.com/gtag/js?l=".concat(m,"&id=").concat(this.data.GoogleMeasurementId))].concat((0,i.A)(this.loadCustomGaScripts())));case 1:return t.abrupt("return",t.sent);case 2:case"end":return t.stop()}},t,this)})),function(){return p.apply(this,arguments)})},{key:"waitForCookiesConsent",value:function(){var t,e=this,n=null!==(t=this.formModel.config.checkCookiesConsent)&&void 0!==t?t:{},a=n.checkInterval,i=n.checkTimeout,o=this.listenForCookieChanges(function(){var t=e.canLoadAnalyticsScripts();"load"===t?(o(),e.loadAnalyticsScripts().then()):"skip"===t&&o()},a,i)}},{key:"gtag",value:function(){window[m].push(arguments)}},{key:"ga",value:function(){window[w].push(arguments)}},{key:"setMixpanelUserId",value:function(t){this.mixpanel.alias(t);try{this.mixpanel.people.set({$name:t,userId:t})}catch(t){}this.mixpanel.identify(t)}},{key:"setGoogleAnalyticsUserId",value:function(t){this.gtag("config","GA_MEASUREMENT_ID",{user_id:t})}},{key:"setUserIdForTrackers",value:function(t){this.setMixpanelUserId(t),this.setGoogleAnalyticsUserId(t)}},{key:"track",value:(a=(0,s.A)(f().mark(function t(e){var n,a,i,o,s,r,c,l=arguments;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},this.selfInitDone){t.next=1;break}return t.next=1,this.selfInit();case 1:a=n.userId,i=void 0===a?null:a,o=n.params,s=void 0===o?{}:o,i&&this.setUserIdForTrackers(i),r=v({close_to_button_enabled:this.formModel.config.buttonEnabled,close_to_button_always_shown:this.formModel.config.buttonEnabledAlways,widget_type:"exit-form",client_name:this.formModel.Client.name},this.formModel.config.eventsAttributes),c=v(v({},r),s),this.gtag("event",e,v(v({},c),{},{send_to:k})),this.sendCustomClientsEvents(e,c),this.mixpanel.track(e,c),document.dispatchEvent(new Event(e,c));case 2:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"sendCustomClientsEvents",value:function(t,e){var n=this;this.getAllowedEvents(t).forEach(function(a){"gtag"===a.type?n.gtag("event","dalia_".concat(t),v(v({},e),{},{send_to:a.group})):"analytics"===a.type&&n.ga("".concat(a.group,".send"),"event","dalia_".concat(t),e)})}},{key:"getAllowedEvents",value:function(t){return this.clientGaEvents.filter(function(e){return e.eventsToTrack.includes(t)})}},{key:"loadCustomGaScripts",value:function(){var t=this;return this.clientGaEvents.map(function(e){"gtag"===e.type?t.loadScript("https://www.googletagmanager.com/gtag/js?l=".concat(m,"&id=").concat(e.measurementId)):"analytics"===e.type&&t.loadScript("https://www.google-analytics.com/analytics.js")})}}]);var a,p,h,g}(h.default)}}]);