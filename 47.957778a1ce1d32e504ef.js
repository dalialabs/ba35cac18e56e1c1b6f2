"use strict";(self.webpackChunkmaia_node=self.webpackChunkmaia_node||[]).push([[47],{23047:(t,e,n)=>{n.r(e),n.d(e,{default:()=>b});n(30050),n(69358),n(59749),n(81919),n(99474),n(35082),n(40739);var a=n(4942),i=n(42982),o=n(70885),s=n(15861),r=n(15671),c=n(43144),l=n(82963),u=n(61120),d=n(79340),p=n(64687),f=n.n(p),h=(n(30024),n(49693),n(60228),n(47522),n(752),n(73964),n(21694),n(76265),n(34338),n(34284),n(38077),n(76801),n(43843),n(50886),n(1937));function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach(function(e){(0,a.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(y=function(){return!!t})()}var m="DaliaNSDataLayer",w="DaliaNSAnalyticsLayer",k="DaliaNSDefault";const b=function(t){function e(t){var n,a,i,o,s=t.document,c=t.data,d=t.clientGaEvents;return(0,r.Z)(this,e),a=this,i=e,o=[{document:s}],i=(0,u.Z)(i),(n=(0,l.Z)(a,y()?Reflect.construct(i,o||[],(0,u.Z)(a).constructor):i.apply(a,o))).data=c,n.formModel=c.form,n.clientGaEvents=d,window[m]=window[m]||[],window[w]=window[w]||[],n.gtag("js",new Date),n.gtag("config",n.data.GoogleMeasurementId,{groups:k}),n.initCustomEvents(),n.selfInit(),n}var a,p,h,g;return(0,d.Z)(e,t),(0,c.Z)(e,[{key:"initCustomEvents",value:function(){var t=this;this.clientGaEvents.forEach(function(e){"gtag"===e.type?t.gtag("config",e.measurementId,{groups:e.group}):"analytics"===e.type&&(t.ga("l",new Date),t.ga("create",e.measurementId,"auto",e.group),t.ga("send","pageview"))})}},{key:"selfInit",value:(g=(0,s.Z)(f().mark(function t(){var e,a,i;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([n.e(84).then(n.t.bind(n,22084,23)),this.tryLoadAnalyticsScripts()]);case 2:e=t.sent,a=(0,o.Z)(e,1),i=a[0],this.mixpanel=i.default.init(this.data.MixPanelToken,{api_host:this.data.APIURL},"dalia-mixpanel"),this.selfInitDone=!0;case 7:case"end":return t.stop()}},t,this)})),function(){return g.apply(this,arguments)})},{key:"tryLoadAnalyticsScripts",value:(h=(0,s.Z)(f().mark(function t(){var e;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("load"!==(e=this.canLoadAnalyticsScripts())){t.next=6;break}return t.next=4,this.loadAnalyticsScripts();case 4:t.next=7;break;case 6:"wait"===e&&this.waitForCookiesConsent();case 7:case"end":return t.stop()}},t,this)})),function(){return h.apply(this,arguments)})},{key:"canLoadAnalyticsScripts",value:function(){var t=this.formModel.config.checkCookiesConsent;if(null!=t&&t.enabled){var e=t.consentAcceptedCookies,n=void 0===e?{}:e,a=t.consentAnsweredCookies,i=this.validateCookies(n);if(!(null!=a?this.validateCookies(a):i))return"wait";if(!i)return"skip"}return"load"}},{key:"loadAnalyticsScripts",value:(p=(0,s.Z)(f().mark(function t(){return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this.loadScript("https://www.googletagmanager.com/gtag/js?l=".concat(m,"&id=").concat(this.data.GoogleMeasurementId))].concat((0,i.Z)(this.loadCustomGaScripts())));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})),function(){return p.apply(this,arguments)})},{key:"waitForCookiesConsent",value:function(){var t,e=this,n=null!==(t=this.formModel.config.checkCookiesConsent)&&void 0!==t?t:{},a=n.checkInterval,i=n.checkTimeout,o=this.listenForCookieChanges(function(){var t=e.canLoadAnalyticsScripts();"load"===t?(o(),e.loadAnalyticsScripts().then()):"skip"===t&&o()},a,i)}},{key:"gtag",value:function(){window[m].push(arguments)}},{key:"ga",value:function(){window[w].push(arguments)}},{key:"setMixpanelUserId",value:function(t){this.mixpanel.alias(t);try{this.mixpanel.people.set({$name:t,userId:t})}catch(t){}this.mixpanel.identify(t)}},{key:"setGoogleAnalyticsUserId",value:function(t){this.gtag("config","GA_MEASUREMENT_ID",{user_id:t})}},{key:"setUserIdForTrackers",value:function(t){this.setMixpanelUserId(t),this.setGoogleAnalyticsUserId(t)}},{key:"track",value:(a=(0,s.Z)(f().mark(function t(e){var n,a,i,o,s,r,c,l=arguments;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},this.selfInitDone){t.next=4;break}return t.next=4,this.selfInit();case 4:a=n.userId,i=void 0===a?null:a,o=n.params,s=void 0===o?{}:o,i&&this.setUserIdForTrackers(i),r=v({close_to_button_enabled:this.formModel.config.buttonEnabled,close_to_button_always_shown:this.formModel.config.buttonEnabledAlways,widget_type:"exit-form",client_name:this.formModel.Client.name,form_id:this.formModel.id,form_type:this.formModel.type||"exit"},this.formModel.config.eventsAttributes),c=v(v({},r),s),this.gtag("event",e,v(v({},c),{},{send_to:k})),this.sendCustomClientsEvents(e,c),this.mixpanel.track(e,c),document.dispatchEvent(new Event(e,c));case 12:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"sendCustomClientsEvents",value:function(t,e){var n=this;this.getAllowedEvents(t).forEach(function(a){"gtag"===a.type?n.gtag("event","dalia_".concat(t),v(v({},e),{},{send_to:a.group})):"analytics"===a.type&&n.ga("".concat(a.group,".send"),"event","dalia_".concat(t),e)})}},{key:"getAllowedEvents",value:function(t){return this.clientGaEvents.filter(function(e){return e.eventsToTrack.includes(t)})}},{key:"loadCustomGaScripts",value:function(){var t=this;return this.clientGaEvents.map(function(e){"gtag"===e.type?t.loadScript("https://www.googletagmanager.com/gtag/js?l=".concat(m,"&id=").concat(e.measurementId)):"analytics"===e.type&&t.loadScript("https://www.google-analytics.com/analytics.js")})}}]),e}(h.default)}}]);