"use strict";(self.webpackChunkmaia_node=self.webpackChunkmaia_node||[]).push([[188],{6188:(e,t,n)=>{n.r(t);n(30050),n(81919),n(99474),n(35082),n(40739),n(84254);var o=n(70885),s=n(71002),i=n(42982),a=n(15861),r=n(4942),l=n(15671),c=n(43144),d=n(82963),u=n(61120),p=n(79340),h=n(64687),m=n.n(h);n(69358),n(752),n(60228),n(21694),n(76265),n(78730),n(79307),n(73964),n(50886),n(77049),n(34338),n(30024),n(12826),n(64043),n(57267),n(49693),n(47522),n(6203),n(38077),n(28436),n(59749),n(86544),n(96869),n(98742),n(19649),n(63975),n(76801),n(43843),n(25728),n(268),n(2918),n(89730),n(97195),n(72410),n(42227),n(41517),n(34284),n(36585),n(65137),n(9873),n(52003);function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,s=function(){};return{s,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){r=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(r)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(b=function(){return!!e})()}var w="dalia-apply-token",k={baseUrl:"http://dashboard.dalia.localhost:3000",submitPath:"api/v2/eapply/web",messagesPath:"eapply/web-messages",customCssPath:"",completeMessage:"You have completed the application questions successfully",blackListMessagesContains:["Reminder"],customCss:"",css:"",isApplyThree:!1,hideBackBtn:!0,remScale:null},C=["Enter","NumpadEnter"],S="api",x=function(e){function t(){var e,n,o,s;return(0,l.Z)(this,t),n=this,o=t,o=(0,u.Z)(o),e=(0,d.Z)(n,b()?Reflect.construct(o,s||[],(0,u.Z)(n).constructor):o.apply(n,s)),console.log("Loading dalia apply web..."),e.attachShadow({mode:"open"}),e}var r,h,f;return(0,p.Z)(t,e),(0,c.Z)(t,[{key:"connectedCallback",value:function(){this.options=g(g({},k),this.dataset),this.isAPICrawler=this.options.crawler===S,this.options.startMinimized=this.options.startMinimized&&"true"===this.options.startMinimized,this.data={};try{this.jobDetails=JSON.parse(this.options.jobDetails)}catch(e){console.log(e)}this.render()}},{key:"getUserToken",value:function(){var e=this.dataset.applyToken;if(e)return this.insideForm="form"===this.options.source,this.insideRVP="rvp"===this.options.source,this.applyInForm=this.insideForm||this.insideRVP,e;var t=new URL(window.location.href);return t.searchParams.has(w)?t.searchParams.get(w):null}},{key:"getSearchParam",value:function(e){var t=new URL(window.location.href);return t.searchParams.has(e)?t.searchParams.get(e):null}},{key:"waitForStyleSheetLoading",value:function(){var e=this.shadowRoot.querySelectorAll('link[as="style"]');return Promise.all(Array.from(e).map(function(e){return new Promise(function(t){e.sheet?t():(e.addEventListener("load",function(){t()}),e.onerror=t)})}))}},{key:"getInitialMessage",value:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"new"){case"new":case"started":return"Hi".concat(this.options.userName?" ".concat(this.options.userName):"","!\n        Thanks for your interest in the <strong>").concat(this.options.jobTitle,"</strong> role in ").concat(this.options.jobLocation,".\n        Please answer the questions below to complete your application.")}}},{key:"canRender",value:function(){return null!==this.getUserToken()}},{key:"render",value:(f=(0,a.Z)(m().mark(function e(){var t,o,s,i,a,r,l,c=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canRender()){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!this.isAPICrawler){e.next=7;break}return this.prepareAPICrawlerSubmit(),this.loadMessages(),e.abrupt("return");case 7:return e.next=9,window.fetch("".concat(this.options.baseUrl,"/html/apply-web.html"));case 9:return t=e.sent,e.next=12,t.text();case 12:return o=e.sent,(s=document.createElement("template")).innerHTML=o,e.next=17,n.e(629).then(n.bind(n,81629));case 17:if(i=e.sent.default.toString(),(a=this.options.remScale&&"undefined"!==this.options.remScale&&"null"!==this.options.remScale)&&(i=i.replace(/(-?\d*\.?\d+)rem\b/g,"$1em")),this.shadowRoot.innerHTML+="<style>".concat(i,"</style><style>").concat(this.options.css,"</style>"),!this.options.customCss||""===this.options.customCss){e.next=28;break}if(!a){e.next=27;break}return e.next=25,this.loadCssWithRemToEm(this.options.customCss);case 25:e.next=28;break;case 27:this.shadowRoot.innerHTML+='<link rel="stylesheet" as="style" href="'.concat(this.options.customCss,'">');case 28:if(!this.options.customCssPath||""===this.options.customCssPath){e.next=35;break}if(!a){e.next=34;break}return e.next=32,this.loadCssWithRemToEm(this.options.customCssPath);case 32:e.next=35;break;case 34:this.shadowRoot.innerHTML+='<link rel="stylesheet" as="style" href="'.concat(this.options.customCssPath,'">');case 35:return e.next=37,this.waitForStyleSheetLoading();case 37:this.dispatchEvent(new Event("apply-component-loaded")),this.shadowRoot.appendChild(s.content.cloneNode(!0)),this.prepareSelectors(),(r="true"===this.options.showJobDetails&&this.getJobDetailsElement(this.jobDetails))&&(this.eApplyPopUp.appendChild(r),this.eApplyPopUpContent.classList.add("hide"),r.querySelectorAll(".apply-btn").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),c.loadMessages(),r.classList.add("hide"),c.eApplyPopUpContent.classList.remove("hide"),c.dispatchEvent(new Event("application-started"))})})),this.renderJobTitle(),this.toggleViewModal(),this.sendMessageEvents(),this.updateDocumentRoot(),this.options.userName&&(l=this.getInitialMessage(this.options.applicationStatus),this.renderMessage(l,!1,this.options.applicationStatus)),this.renderLoadingImage(),"true"!==this.options.showJobDetails&&this.loadMessages(),this.handleResize(),this.applyInForm&&!this.options.startMinimized&&this.applyWebContainer.classList.add("popup-opened"),this.options.startMinimized?this.minimizePopUp():this.continueAplyingContainer.click(),e.next=57;break;case 54:e.prev=54,e.t0=e.catch(2),console.error(e.t0);case 57:case"end":return e.stop()}},e,this,[[2,54]])})),function(){return f.apply(this,arguments)})},{key:"getJobTags",value:function(e){var t=e||{},n=t.city,o=t.state,s=t.pay_rate,i=t.type,a=[n,o].filter(Boolean).join(",");return'\n          <div class="job-tags">\n            '.concat(a&&'<span class="job-tag" >'.concat(a,"</span>"),"\n            ").concat(s&&'<span class="job-tag" >'.concat(s,"</span>"),"\n            ").concat(i&&'<span class="job-tag" >'.concat(i,"</span>"),"\n          </div>\n    ")}},{key:"initGeocoder",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{o=g({types:"place,locality,neighborhood",placeholder:"What is your location?",countries:"us,ca"},o);var s=document.createElement("div");s.innerHTML=o.placeholder;var i=s.textContent.trim(),a=document.createElement("style");a.textContent="\n        .mapboxgl-ctrl-geocoder {\n          box-shadow: none !important;\n        }\n        .mapboxgl-ctrl-geocoder--input {\n          padding: 6px 10px !important;\n        }\n        .suggestions-wrapper {\n          background: #f5f5f5 !important;\n        }\n      ",this.shadowRoot.appendChild(a);var r=document.createElement("link");r.rel="stylesheet",r.href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css",this.shadowRoot.appendChild(r),n.e(950).then(n.bind(n,9048)).then(function(n){var s=new(0,n.default)({getItemValue:function(e){return e.address},placeholder:i,countries:o.countries,types:o.types,language:"en",minLength:3,limits:5,clientName:"Dalia",APIURL:"".concat(t.options.baseUrl,"/api"),clearAndBlurOnEsc:!0,clearOnBlur:!1,collapsed:!1});e.querySelector(".bubble").appendChild(s.onAdd()),s.on("result",function(e){if(e){t.enableChatInput(),t.updateMessageFormAndSendMessage(e);var n=t.shadowRoot.querySelector(".geocoder-container");n&&n.remove()}})})}catch(e){console.error("Error initializing geocoder:",e),this.enableChatInput()}}},{key:"decodeHTML",value:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}},{key:"getJobDetailsElement",value:function(e){var t;if(e){var n=document.createElement("div");return n.setAttribute("id","job-details"),n.innerHTML='\n      <div class="jobs-container-sm job-container">\n        <div class="d-flex justify-content-between flex-column flex-md-row gap-1 sticky-top header">\n          <div class="d-flex flex-column align-items-start job-title-container">\n              <div class="d-flex align-items-baseline flex-column info">\n                <div class="d-flex mb-2 align-items-center">\n                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">\n                    <path d="M15 4.375H13.9583V3.33333C13.9583 2.52917 13.3042 1.875 12.5 1.875H7.5C6.69583 1.875 6.04167 2.52917 6.04167 3.33333V4.375H5C2.985 4.375 1.875 5.485 1.875 7.5V7.59918V9.37754V15C1.875 17.015 2.985 18.125 5 18.125H15C17.015 18.125 18.125 17.015 18.125 15V9.37754V7.59918V7.5C18.125 5.485 17.015 4.375 15 4.375ZM7.29167 3.33333C7.29167 3.21833 7.385 3.125 7.5 3.125H12.5C12.615 3.125 12.7083 3.21833 12.7083 3.33333V4.375H7.29167V3.33333ZM3.125 7.5C3.125 6.18583 3.68583 5.625 5 5.625H15C16.3142 5.625 16.875 6.18583 16.875 7.5V7.59918V9.37754C16.875 9.62838 16.7325 9.84745 16.5033 9.94995C15.7825 10.2716 14.5542 10.73 12.7983 11.0884C12.7125 11.1059 12.62 11.04 12.57 10.9667C11.9658 10.0642 11.0058 9.52586 10 9.52586C8.99417 9.52586 8.03417 10.0642 7.43 10.9667C7.38083 11.0409 7.29167 11.1075 7.20166 11.0884C5.44667 10.73 4.2175 10.2716 3.49667 9.94995C3.2675 9.84745 3.125 9.62838 3.125 9.37754V7.59918V7.5ZM15 16.875H5C3.68583 16.875 3.125 16.3142 3.125 15V11.15C3.91667 11.4925 5.18584 11.9517 6.95084 12.3125C7.52584 12.4292 8.12417 12.175 8.46834 11.6609C8.84 11.1059 9.4125 10.775 10 10.775C10.5875 10.775 11.16 11.1059 11.5308 11.6609C11.8192 12.0917 12.2842 12.3408 12.7667 12.3408C12.86 12.3408 12.9542 12.3317 13.0475 12.3125C14.8133 11.9517 16.0825 11.4925 16.8742 11.15V15C16.875 16.3142 16.3142 16.875 15 16.875ZM10.85 12.5C10.85 12.96 10.4767 13.3333 10.0167 13.3333C9.55667 13.3333 9.17917 12.96 9.17917 12.5C9.17917 12.04 9.5475 11.6667 10.0083 11.6667H10.0167C10.4767 11.6667 10.85 12.04 10.85 12.5Z" fill="currentColor"/>\n                  </svg>\n                  <span class="job-title ms-2">'.concat(e.title,"</span>\n                </div>\n                ").concat(e["tags.company"]?'<div class="d-flex mb-2 align-items-center">\n                   <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">\n                      <path d="M16.6675 7.6217L13.9583 7.00178V5.67345C13.9583 4.79512 13.3608 4.04417 12.505 3.84667L4.17165 1.92345C3.61165 1.79429 3.03331 1.92502 2.58331 2.28336C2.13331 2.64169 1.875 3.17585 1.875 3.75085V15.8342C1.875 17.2908 2.71 18.1258 4.16667 18.1258H15.8333C17.29 18.1258 18.125 17.2908 18.125 15.8342V9.45011C18.125 8.57011 17.5258 7.81753 16.6675 7.6217ZM3.125 15.8334V3.75003C3.125 3.55837 3.21163 3.3801 3.3608 3.26094C3.4733 3.17177 3.60921 3.12503 3.74837 3.12503C3.79587 3.12503 3.84331 3.13005 3.88997 3.14172L12.2233 5.06493C12.5091 5.13077 12.7083 5.38095 12.7083 5.67345V7.50003V16.875H10.2083V14.1667C10.2083 12.9025 9.18083 11.875 7.91667 11.875C6.6525 11.875 5.625 12.9025 5.625 14.1667V16.875H4.16667C3.3975 16.875 3.125 16.6025 3.125 15.8334ZM8.95833 16.875H6.875V14.1667C6.875 13.5925 7.3425 13.125 7.91667 13.125C8.49083 13.125 8.95833 13.5925 8.95833 14.1667V16.875ZM16.875 15.8334C16.875 16.6025 16.6025 16.875 15.8333 16.875H13.9583V8.28413L16.3892 8.83996C16.675 8.90579 16.875 9.15596 16.875 9.44929V15.8334ZM8.54167 7.50003C8.54167 7.15503 8.82167 6.87503 9.16667 6.87503H10C10.345 6.87503 10.625 7.15503 10.625 7.50003C10.625 7.84503 10.345 8.12503 10 8.12503H9.16667C8.82167 8.12503 8.54167 7.84503 8.54167 7.50003ZM5.20833 7.50003C5.20833 7.15503 5.48833 6.87503 5.83333 6.87503H6.66667C7.01167 6.87503 7.29167 7.15503 7.29167 7.50003C7.29167 7.84503 7.01167 8.12503 6.66667 8.12503H5.83333C5.48833 8.12503 5.20833 7.84503 5.20833 7.50003ZM8.54167 10C8.54167 9.65503 8.82167 9.37503 9.16667 9.37503H10C10.345 9.37503 10.625 9.65503 10.625 10C10.625 10.345 10.345 10.625 10 10.625H9.16667C8.82167 10.625 8.54167 10.345 8.54167 10ZM5.20833 10C5.20833 9.65503 5.48833 9.37503 5.83333 9.37503H6.66667C7.01167 9.37503 7.29167 9.65503 7.29167 10C7.29167 10.345 7.01167 10.625 6.66667 10.625H5.83333C5.48833 10.625 5.20833 10.345 5.20833 10Z" fill="currentColor"/>\n                    </svg>\n                      <span class="ms-2">'.concat(e["tags.company"],"</span>\n                     </div>"):"",'\n              </div>\n          </div>\n          <div class="d-flex apply-container">\n              <a class="apply-btn btn btn-primary action-btn rounded-pill mt-3 hide-mobile" href="#" target="_blank">Apply</a>\n          </div>\n        </div>\n        ').concat(this.getJobTags(e),'\n        <h4>Job Description</h4>\n        <div class="inner-container pb-3 pt-md-3">\n          <div class="job-description">\n              <p>\n                ').concat(this.decodeHTML(null===(t=e.description)||void 0===t?void 0:t.replace(/\[+[^\]]*]+/g,"")),'\n              </p>\n          </div>\n          <div class="apply-btn-container">\n            <a class="apply-btn btn btn-primary action-btn rounded-pill my-5 text-uppercase d-none d-md-flex" href="#" target="_blank">Apply Now</a>\n          </div>\n      </div>\n    '),n}}},{key:"updateQuickApplyBtn",value:function(){document.querySelectorAll(".quick-apply-btn").forEach(function(e){e&&(e.innerText="Applied",e.disabled=!0,e.style.borderRadius="12px !important",e.classList.replace("btn-success","btn-secondary"),document.querySelectorAll(".animated-button span").forEach(function(e){e.style.animation="none"}))})}},{key:"prepareAPICrawlerSubmit",value:function(){var e=this,t=document.querySelector(".confirm-apply-btn");document.querySelectorAll(".quick-apply-btn").forEach(function(e){e.innerText="Quick Apply"}),t.addEventListener("click",function(){e.sendMessage("yes"),e.updateQuickApplyBtn()})}},{key:"handleResize",value:function(){var e=this,t=!1;this.chatInput.addEventListener("focus",function(){t=!0}),this.chatInput.addEventListener("focusout",function(){t=!1});var n=window.visualViewport.height;window.visualViewport.addEventListener("resize",function(){e.applyWebContainer.classList.contains("popup-opened")&&(t&&window.visualViewport.height<n?(e.insideForm||e.insideRVP||(e.applyWebContainer.style.height="".concat(window.visualViewport.height,"px")),e.shadowRoot.querySelector(".chat-messages .content").scrollTo(0,e.shadowRoot.querySelector(".chat-messages .content").scrollHeight)):e.insideForm||e.insideRVP||e.applyWebContainer.removeAttribute("style"))})}},{key:"updateDocumentRoot",value:function(){var e=this,t=document.querySelectorAll(".apply-btn");t.length>0&&t.forEach(function(t){t.removeAttribute("href"),t.removeAttribute("target"),t.addEventListener("click",function(){e.applyWebContainer.classList.add("popup-opened"),e.getSearchParam("submit-application")&&e.sendMessage("yes")})})}},{key:"renderMessages",value:function(e){var t=this;e.applyApplication&&(e=this.data=g(g({},e),this.reformatApply3Data(e)));var n=this.shadowRoot.querySelector(".bubble-container.loading-message");n&&n.remove(),e.messages.forEach(function(n){var o;t.renderMessage(n.options.content,"user"===n.initiator,e.appUserStatus,null===(o=n.options)||void 0===o?void 0:o.isPreformattedHtml)});var o=this.shadowRoot.querySelector(".chat-messages .content");o&&o.scrollTo(0,o.scrollHeight),setTimeout(function(){return t.checkAndHideResumeUploadForms()},200)}},{key:"isQuestionAnswered",value:function(e){var t=e||{},n=t.answer,o=t.answers;return!(!n&&!o)&&[n].concat((0,i.Z)(o)).some(function(e){return e&&"incoming"===e.type})}},{key:"reformatApply3Data",value:function(e){var t,n,o=this,s=[],i=new Set;if(null==e||null===(t=e.applyApplication)||void 0===t||!t.operations||!Array.isArray(e.applyApplication.operations))return{messages:s,appUserStatus:null===(n=e.applyApplication)||void 0===n?void 0:n.status};var a,r=v(e.applyApplication.operations.filter(function(e){var t;return null==e||null===(t=e.question)||void 0===t?void 0:t.selector}));try{var l=function(){var e,t,n,r=a.value,l=!1;if(null!==(e=r.question)&&void 0!==e&&e.parsedText){var c,d,u="resume_upload"===(null===(c=r.question)||void 0===c?void 0:c.selector)||"file"===(null===(d=r.question)||void 0===d?void 0:d.type),p=o.isQuestionAnswered(r);u&&p||(s.push({options:{content:p?r.question.originalText:r.question.parsedText},initiator:"system"}),l=!0)}if(null!==(t=r.answer)&&void 0!==t&&t.originalText){var h,m,f,y,g=r.answer.originalText;Array.isArray(g)&&(g=g.join("")),"string"!=typeof g&&(g=String(g));var b="resume_upload"===(null===(h=r.question)||void 0===h?void 0:h.selector)||"file"===(null===(m=r.question)||void 0===m?void 0:m.type)||g&&(g.includes("storage.googleapis.com")||g.includes("file-upload/resume/")||g.includes("/resume/")),w=(null===(f=r.question)||void 0===f||null===(f=f.options)||void 0===f||null===(y=f.find)||void 0===y||null===(y=y.call(f,function(e){return e.value===r.answer.parsedText}))||void 0===y?void 0:y.text)||g;if(b&&g){var k=g.trim().split("?")[0];if(i.has(k))w=null;else{var C,S=(null===(C=g.split("/").pop())||void 0===C?void 0:C.split("?")[0])||"Resume.pdf";w=o.formatResumeAnswer(g,S),i.add(k)}}w&&s.push({options:{content:w,isPreformattedHtml:!!b},initiator:"user"})}if((null===(n=r.answers)||void 0===n?void 0:n.length)>0){var x,q=v(r.answers);try{var A=function(){var e,t,n=x.value;l||"outgoing"!==n.type&&"outgoing_reminder"!==n.type||(s.push({options:{content:(null===(e=r.question)||void 0===e||null===(e=e.options)||void 0===e||null===(t=e.find)||void 0===t||null===(t=t.call(e,function(e){var t;return e.value===n.parsedText||e.value===(null===(t=n.parsedText)||void 0===t?void 0:t.value)}))||void 0===t?void 0:t.text)||n.originalText},initiator:"system"}),l=!0);if("outgoing_error"===n.type&&s.push({options:{content:n.originalText},initiator:"system"}),"incoming"===n.type){var a,c,d,u,p,h,m=(null===(a=r.question)||void 0===a||null===(a=a.options)||void 0===a||null===(c=a.find)||void 0===c||null===(c=c.call(a,function(e){var t;return e.value===n.parsedText||e.value===(null===(t=n.parsedText)||void 0===t?void 0:t.value)}))||void 0===c?void 0:c.text)||n.originalText;Array.isArray(m)&&(m=m.join("")),"string"!=typeof m&&(m=String(m));var v="resume_upload"===(null===(d=r.question)||void 0===d?void 0:d.selector)||"file"===(null===(u=r.question)||void 0===u?void 0:u.type)||m&&(m.includes("storage.googleapis.com")||m.includes("file-upload/resume/")||m.includes("/resume/")),f=(null===(p=r.question)||void 0===p||null===(p=p.options)||void 0===p||null===(h=p.find)||void 0===h||null===(h=h.call(p,function(e){return e.value===n.parsedText}))||void 0===h?void 0:h.text)||m;if(v&&m){var y=m.trim().split("?")[0];if(i.has(y))f=null;else{var g,b=(null===(g=m.split("/").pop())||void 0===g?void 0:g.split("?")[0])||"Resume.pdf";f=o.formatResumeAnswer(m,b),i.add(y)}}f&&s.push({options:{content:f,isPreformattedHtml:!!v},initiator:"user"})}};for(q.s();!(x=q.n()).done;)A()}catch(e){q.e(e)}finally{q.f()}}};for(r.s();!(a=r.n()).done;)l()}catch(e){r.e(e)}finally{r.f()}return{messages:s,appUserStatus:e.applyApplication.status}}},{key:"loadMessages",value:function(){var e=this;window.fetch("".concat(this.options.baseUrl,"/").concat(this.options.messagesPath),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({daliaApplyToken:this.getUserToken(),runAlgorithm:this.applyInForm,source:this.options.source})}).then(function(e){return e.json()}).then(function(t){var n,o;(e.token=t.token,t.applyApplication&&(t=e.data=g(g({},t),e.reformatApply3Data(t))),e.isUserApplied(t.appUserStatus))?e.isAPICrawler?e.updateQuickApplyBtn():e.handleSubmissionComplete(t.appUserStatus,null===(o=t)||void 0===o?void 0:o.message):e.isAPICrawler||(e.renderMessages(t),e.checkForPendingFormReview());!e.applyInForm&&(e.options.isApplyThree||!(null!==(n=t.messages)&&void 0!==n&&n.length)||t.messages[t.messages.length-1]&&"system"!==t.messages[t.messages.length-1].initiator)&&e.sendMessage("SIGNAL_APPLY")})}},{key:"checkForPendingFormReview",value:(h=(0,a.Z)(m().mark(function e(){var t,n,o,s=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.fetch("".concat(this.options.baseUrl,"/").concat(this.options.submitPath),{method:"POST",headers:{"x-api-token":this.token,"Content-Type":"application/json"},body:JSON.stringify({daliaApplyToken:this.getUserToken(),answer:"",userClickedApplyWebButton:!0})});case 3:return t=e.sent,e.next=6,t.json();case 6:if(n=e.sent,(o=this.shadowRoot.querySelector(".bubble-container.loading-message"))&&o.remove(),"FORM_REVIEW"!==n.type){e.next=13;break}return this.disableChatInput(),this.renderFormReview(n.formsData),e.abrupt("return",!0);case 13:if("FORM_MODAL"!==n.type){e.next=17;break}return this.handleFormModal(n),n.completed&&setTimeout(function(){s.renderLoadingImage(),s.sendMessage("")},300),e.abrupt("return",!0);case 17:return e.abrupt("return",!1);case 20:return e.prev=20,e.t0=e.catch(0),console.log("Error checking for pending form review:",e.t0),e.abrupt("return",!1);case 24:case"end":return e.stop()}},e,this,[[0,20]])})),function(){return h.apply(this,arguments)})},{key:"renderJobTitle",value:function(){var e=this;this.shadowRoot.querySelectorAll(".job-title").forEach(function(t){var n,o=e.options.jobTitle||(null===(n=document.querySelector(".job-title"))||void 0===n?void 0:n.innerText)||document.querySelector("title").innerText.split("|")[0].trim();t.innerText="".concat(o),t.setAttribute("data-tooltip",o)}),this.shadowRoot.querySelectorAll(".client-name").forEach(function(t){var n;t.innerText=e.options.clientName||(null===(n=document.querySelector(".client-name"))||void 0===n?void 0:n.innerText)||document.querySelector("title").innerText.split("|")[1].trim()})}},{key:"prepareSelectors",value:function(){var e=this;this.applyWebContainer=this.shadowRoot.querySelector(".eapply-web-container"),this.options.source&&this.applyWebContainer.setAttribute("data-container-type",this.options.source),this.chatInput=this.shadowRoot.querySelector(".chat-input"),this.chatInputContainer=this.shadowRoot.querySelector(".chat-controls"),this.options.placeHolder&&this.chatInput.setAttribute("placeholder",this.options.placeHolder),this.applyButton=this.shadowRoot.querySelector(".apply-now"),this.sendButton=this.shadowRoot.querySelector(".btn-send"),this.chatLoader=this.shadowRoot.querySelector(".chat-messages > .loader"),this.headerContainer=this.shadowRoot.querySelector(".popup-header"),this.backButton=this.shadowRoot.querySelector(".popup-header .back-btn"),this.eApplyPopUp=this.shadowRoot.querySelector(".eapply-popup"),this.eApplyPopUpContent=this.shadowRoot.querySelector(".eapply-popup .popup-content"),this.jobsCount=this.shadowRoot.querySelector("#jobs-count"),this.jobsCount&&(this.jobsCount.innerText=this.options.jobsCount||3),this.backButton&&this.backButton.addEventListener("click",function(){var t;e.dispatchEvent(new Event(e.isUserApplied(null===(t=e.data)||void 0===t?void 0:t.appUserStatus)?"submitted":"back-btn-clicked",{bubbles:!1}))}),this.minimizeButton=this.shadowRoot.querySelector(".close-popup"),this.continueAplyingContainer=this.shadowRoot.querySelector("#continue-applying-container"),this.continueAplyingContainer&&this.continueAplyingContainer.addEventListener("click",function(){e.dispatchEvent(new Event("popup-opened"),{bubbles:!1}),e.continueAplyingContainer.classList.add("hide"),e.eApplyPopUp.classList.remove("hide"),e.applyWebContainer.classList.add("popup-opened")}),this.options.hideBackBtn&&"false"!==this.options.hideBackBtn||this.backButton.classList.remove("hide"),"true"===this.options.hideHeader&&this.headerContainer.classList.add("hide")}},{key:"closePopUp",value:function(){this.applyWebContainer.classList.remove("popup-opened"),this.applyWebContainer.removeAttribute("style")}},{key:"minimizePopUp",value:function(){this.eApplyPopUp.classList.add("hide"),this.continueAplyingContainer.classList.remove("hide")}},{key:"toggleViewModal",value:function(){var e=this;this.applyButton.addEventListener("click",function(){e.applyWebContainer.classList.add("popup-opened")}),this.shadowRoot.querySelectorAll(".completed .eapply-btn").forEach(function(t){t.addEventListener("click",function(){e.insideForm||e.insideRVP?e.dispatchEvent(new Event("submitted",{bubbles:!1})):e.closePopUp()})}),this.shadowRoot.querySelectorAll(".close-popup").forEach(function(t){t.addEventListener("click",function(){e.minimizePopUp(),e.dispatchEvent(new Event("popup-closed",{bubbles:!1}))})})}},{key:"sendMessageEvents",value:function(){var e=this;this.chatInput.addEventListener("keydown",function(t){C.includes(t.code)&&e.updateMessageFormAndSendMessage(t.target.value)}),this.sendButton.addEventListener("click",function(){e.updateMessageFormAndSendMessage(e.chatInput.value)})}},{key:"sendMessage",value:function(e){var t=this;e&&(this.renderLoadingImage(),window.fetch("".concat(this.options.baseUrl,"/").concat(this.options.submitPath),{method:"POST",headers:{"x-api-token":this.token,"Content-Type":"application/json"},body:JSON.stringify({daliaApplyToken:this.getUserToken(),answer:e,userClickedApplyWebButton:!0,source:this.options.source})}).then(function(e){return e.json()}).then(function(e){if(t.chatLoader.classList.remove("show"),t.data.appUserStatus=e.appUserStatus,"FORM_REVIEW"===e.type){var n=t.shadowRoot.querySelector(".bubble-container.loading-message");return n&&n.remove(),t.disableChatInput(),t.renderFormReview(e.formsData),void setTimeout(function(){t.enableReviewButtons(),t.disableChatInput()},100)}if("FORM_MODAL"!==e.type){if("submitted"===e.appUserStatus||"SUBMITTED"===e.type)return e.message&&t.renderMessage(e.message,!1,e.appUserStatus),t.disableChatInput(),void t.disableReviewButtons();var o=t.shadowRoot.querySelector(".bubble-container.loading-message");o&&o.remove(),e.message&&t.renderMessage(e.message,!1,e.appUserStatus),e.message.includes("<form>")||e.message.includes('data-searchable-select="true"')||(t.chatInput.removeAttribute("disabled"),t.sendButton.removeAttribute("disabled"),t.chatInput.focus()),t.currentFormsData&&setTimeout(function(){t.enableReviewButtons()},100),setTimeout(function(){var e=t.shadowRoot.querySelector('input[data-searchable-select="true"]:not([disabled])'),n=t.shadowRoot.querySelector(".chat-messages form:not([data-form-submitted])"),o=t.shadowRoot.querySelector(".form-review-container");!e&&!n&&!o&&t.chatInput&&t.chatInput.disabled&&t.enableChatInput()},200)}else{var s=t.shadowRoot.querySelector(".bubble-container.loading-message");s&&s.remove(),t.handleFormModal(e),e.completed&&(!0===e.isEditMode&&t.currentFormsData?setTimeout(function(){var n=t.shadowRoot.querySelector(".bubble-container.loading-message");n&&n.remove(),t.showFormEditSuccess(e.formName),t.enableReviewButtons(),t.sendMessage("FORM SUBMITTED")},300):setTimeout(function(){var e=t.shadowRoot.querySelector(".bubble-container.loading-message");e&&e.remove(),t.sendMessage("FORM SUBMITTED")},300))}}))}},{key:"updateMessageFormAndSendMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t){this.chatInput.setAttribute("disabled","disabled"),this.sendButton.setAttribute("disabled","disabled"),this.renderMessage("object"===(0,s.Z)(t)?t.text:t,!0,null),this.chatInput.value="";setTimeout(function t(){e.chatInput.hasAttribute("disabled")?setTimeout(t,100):e.chatInput.focus()},500),this.sendMessage("object"===(0,s.Z)(t)?t.value:t)}}},{key:"renderLoadingImage",value:function(){this.chatInput&&(this.chatInput.disabled=!0,this.sendButton.disabled=!0);var e=document.createElement("template");e.innerHTML='<div class="bubble-container loading-message">\n      <div class="bubble" style="background: #FFF; border: none">\n        <div><img style="width:65px" src="'.concat(this.options.baseUrl,'/images/apply-loading-grey.gif"></div>\n      </div>\n    </div>');var t=this.shadowRoot.querySelector(".chat-messages .content");t&&t.appendChild(e.content.cloneNode(!0))}},{key:"isFormContextMessage",value:function(e){try{var t=e;if("string"==typeof e){var n=e;if(e.includes("<p>")&&e.includes("</p>")&&e.includes("formName")){if(e.startsWith("<p>")&&e.endsWith("</p>"))n=e.slice(3,-4);else if(e.includes("formName")&&e.startsWith("{"))n=e;else{var o=e.indexOf("<p>"),i=e.lastIndexOf("</p>");-1!==o&&-1!==i&&i>o&&(n=e.slice(o+3,i))}n=n.replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}try{t=JSON.parse(n)}catch(e){return!1}}return t&&"object"===(0,s.Z)(t)&&t.formName&&t.messages&&t.formContextKey&&Array.isArray(t.messages)}catch(e){return!1}}},{key:"handleFormContext",value:function(e){var t=this;try{var n=e;if("string"==typeof e){var o=e;if(e.includes("<p>")&&e.includes("</p>")&&e.includes("formName")){if(e.startsWith("<p>")&&e.endsWith("</p>"))o=e.slice(3,-4);else{var s=e.indexOf("<p>"),i=e.lastIndexOf("</p>");-1!==s&&-1!==i&&i>s&&(o=e.slice(s+3,i))}o=o.replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}try{n=JSON.parse(o)}catch(e){return}}var a="form_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),r='\n        <div class="form-context-container" data-form-id="'.concat(a,'">\n          <div class="form-header">\n            <h3 class="form-title">').concat(n.formName,'</h3>\n            <div class="form-subtitle">Please read the information below, then answer the questions that follow.</div>\n          </div>\n          <div class="form-messages">\n            <div class="form-messages-content" data-form-id="').concat(a,'">\n              ').concat(n.messages.map(function(e){return'<div class="form-message-content">'.concat(e.replace(/\\"/g,'"').trim(),"</div>")}).join(""),'\n            </div>\n            <div class="form-messages-toggle">\n              <button class="read-more-btn" data-form-id="').concat(a,'" data-form-key="').concat(n.formContextKey,'">\n                <span class="read-more-text">Read More</span>\n                <svg class="read-more-arrow" width="12" height="8" viewBox="0 0 12 8" fill="none">\n                  <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                </svg>\n              </button>\n            </div>\n          </div>\n          <div class="form-ready-indicator">\n            <button class="continue-btn" data-form-id="').concat(a,'" data-form-key="').concat(n.formContextKey,'">\n              <span>Continue to Questions</span>\n              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">\n                <path d="M8 1L15 8L8 15M15 8H1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      ');this.renderRegularMessage(r,!1),this.disableChatInput(),setTimeout(function(){var e=t.shadowRoot.querySelector('[data-form-id="'.concat(a,'"].read-more-btn')),n=t.shadowRoot.querySelector('[data-form-id="'.concat(a,'"].continue-btn'));e&&e.addEventListener("click",t.handleReadMoreClick.bind(t)),n&&n.addEventListener("click",function(){t.handleFormContextContinue(n)})},100)}catch(t){this.renderRegularMessage(e,!1)}}},{key:"handleReadMoreClick",value:function(e){var t=e.target.closest(".read-more-btn"),n=t.closest(".form-messages").querySelector(".form-messages-content"),o=t.querySelector(".read-more-text"),s=t.querySelector(".read-more-arrow");n.classList.contains("expanded")?(n.classList.remove("expanded"),o.textContent="Read More",s.style.transform="rotate(0deg)"):(n.classList.add("expanded"),o.textContent="Read Less",s.style.transform="rotate(180deg)")}},{key:"handleFormContextContinue",value:function(e){if(e){e.style.display="none";var t=e.closest(".form-ready-indicator");t&&(t.style.display="none")}this.updateMessageFormAndSendMessage("continue")}},{key:"renderRegularMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.createElement("template");e&&(e=e.replace(/((http|https|ftp):\/\/[\w?=&.-;#~%-]+(?![\w\s?&.;#~%"=-]*>))/g,'<a href="$1" target="_blank">Click Here</a>')),n.innerHTML='<div class="bubble-container '.concat(t?"from-user":"",'">\n      <div class="bubble">\n        <div>').concat(e,"</div>\n      </div>\n    </div>");var o=this.shadowRoot.querySelector(".chat-messages .content");o&&o.appendChild(n.content.cloneNode(!0))}},{key:"renderMessage",value:function(e){var t,n=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.options.blackListMessagesContains.some(function(t){return e&&e.includes(t)})){if(!o){var a=this.shadowRoot.querySelector(".loading-message");a&&a.remove()}if(this.isFormContextMessage(e))this.handleFormContext(e);else{var r=document.createElement("template");if(!i&&e&&"already_applied"!==s){e=e.replace(/((http|https|ftp):\/\/[\w?=&.-;#~%-]+(?![\w\s?&.;#~%"=-]*>))/g,'<a href="$1" target="_blank">click here</a>')}if(r.innerHTML='<div class="bubble-container '.concat(o?"from-user":"",'">\n      <div class="bubble">\n        ').concat(i?e:"<div>".concat(e,"</div>"),"\n      </div>\n    </div>"),!o&&("What is your location?"===e||null!==(t=e)&&void 0!==t&&t.includes("home address"))){var l,c=document.createElement("div");c.setAttribute("id","geocoder-container"),c.classList.add("bubble-container"),o&&c.classList.add("from-user"),c.innerHTML='<div class="bubble" style="padding: 0.5rem !important; overflow: visible !important;"></div>',this.shadowRoot.querySelector(".chat-messages .content").appendChild(c),this.initGeocoder(c,g({},null!==(l=e)&&void 0!==l&&l.includes("home address")?{placeholder:e,types:"address"}:{}));var d=this.shadowRoot.querySelector(".chat-messages"),u=setInterval(function(){n.disableChatInput(),c.querySelector("input")&&c.querySelector("input").focus(),d&&d.scrollTo(0,d.scrollHeight);var t=d.querySelectorAll(".bubble-container");"geocoder-container"!==t[t.length-1].id&&(c.innerHTML='\n          <div class="bubble">\n            <div>'.concat(e,"</div>\n          </div>"),clearInterval(u))},250)}else{var p=this.shadowRoot.querySelector(".chat-messages .content");p&&(p.appendChild(r.content.cloneNode(!0)),setTimeout(function(){var e,t=null===(e=n.shadowRoot.querySelector(".chat-messages .content"))||void 0===e?void 0:e.scrollHeight;t&&p.scrollTo(0,t)},100)),this.handleCustomForm(e)}this.checkAndHideResumeUploadForms(),this.handleSubmissionComplete(s,e)}}}},{key:"initializeFormContextInteractions",value:function(){var e=this;this.shadowRoot.querySelectorAll(".read-more-btn:not([data-initialized])").forEach(function(t){t.setAttribute("data-initialized","true"),t.addEventListener("click",function(n){n.preventDefault();var o=t.getAttribute("data-form-key");o&&e.toggleFormMessages(o)})}),this.shadowRoot.querySelectorAll(".continue-btn:not([data-initialized])").forEach(function(t){t.setAttribute("data-initialized","true"),t.addEventListener("click",function(t){t.preventDefault(),e.proceedWithQuestions()})})}},{key:"toggleFormMessages",value:function(e){var t=this,n=this.shadowRoot.getElementById("form-messages-"+e);if(n){var o=n.querySelector(".form-messages-content"),s=n.querySelector(".read-more-btn"),i=s.querySelector(".read-more-text"),a=s.querySelector(".read-more-arrow");o.classList.contains("expanded")?(o.classList.remove("expanded"),i.textContent="Read More",a.style.transform="rotate(0deg)"):(o.classList.add("expanded"),i.textContent="Show Less",a.style.transform="rotate(180deg)"),setTimeout(function(){var e=t.shadowRoot.querySelector(".chat-messages");e&&e.scrollTo(0,e.scrollHeight)},300)}}},{key:"proceedWithQuestions",value:function(){this.chatInput&&this.sendButton&&(this.chatInput.value="continue",this.sendButton.click())}},{key:"handleFormContextScroll",value:function(e){var t=this;e&&"string"==typeof e&&e.includes("form-context-container")&&setTimeout(function(){var e=t.shadowRoot.querySelectorAll(".form-context-container");if(e.length>0){var n=e[e.length-1];if(t.shadowRoot.querySelector(".chat-messages")&&n){var o=n.querySelector(".form-header")||n;o.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),o.style.transition="background-color 0.3s ease",o.style.backgroundColor="rgba(59, 130, 246, 0.1)",setTimeout(function(){o.style.backgroundColor=""},1500)}}},300)}},{key:"validateFileExtension",value:function(e){return!!/(\.pdf|\.docx|\.doc|\.jpg|\.jpeg|\.png|\.txt)$/i.test(e.value)||(alert("Invalid file type."),e.form.reset(),e.focus(),!1)}},{key:"handleCustomForm",value:function(e){var t=this;e.includes("<form>")?(this.chatInput.setAttribute("disabled","disabled"),this.chatInput.classList.add("button-disabled"),this.sendButton.setAttribute("disabled","disabled"),this.sendButton.classList.add("button-disabled")):(this.chatInput.removeAttribute("disabled"),this.chatInput.classList.remove("button-disabled"),this.sendButton.removeAttribute("disabled"),this.sendButton.classList.remove("button-disabled"),this.enableChatInput()),this.initializeSearchableSelects();var n=this.shadowRoot.querySelectorAll(".chat-messages form");n.length&&n[n.length-1].addEventListener("submit",function(e){if(e.preventDefault(),t.customFormValue=null,(0,i.Z)(e.target.children).some(function(e){return"file"===e.type})){var n=e.target.querySelector('input[type="file"]');if(!t.validateFileExtension(n))return;t.customFormValue=n.files[0],t.customFormValue&&t.sendFile(t.customFormValue)}else if((0,i.Z)(e.target.children).some(function(e){return"date"===e.type})){var o=e.target.querySelector('input[type="date"]');o.value&&t.updateMessageFormAndSendMessage(o.value)}else if(e.target.querySelector('input[data-searchable-select="true"]')){var s=e.target.querySelector('input[data-searchable-select="true"]'),a=e.target.querySelector('input[name="answer"]');if(!a||!a.value)return void t.renderMessage("Please select an option from the list",!1,null);t.renderMessage(s.value,!0,null),t.sendMessage(a.value)}else{var r=(0,i.Z)(e.target.querySelectorAll('input[name="answer"]:checked'));if(!r.length)return;t.updateMessageFormAndSendMessage({text:r.map(function(e){return e.nextElementSibling.innerText}).join(", "),value:r.map(function(e){return e.value}).join(",")})}t.customFormValue&&(e.target.querySelector("button")&&e.target.querySelector("button").remove(),e.target.querySelectorAll("input").forEach(function(e){e.setAttribute("disabled","disabled")}))}),n.length>1&&n.forEach(function(e,t){t!==n.length-1&&(e.querySelector("button")&&e.querySelector("button").remove(),e.querySelectorAll("input").forEach(function(e){e.remove()}),e.querySelectorAll(".radio-toggle-buttons-container").forEach(function(e){e.remove()}))}),this.shadowRoot.querySelectorAll(".question-skip-btn").forEach(function(e){e.addEventListener("click",function(n){n.preventDefault();var o=t.shadowRoot.querySelectorAll(".question-skip-btn"),s=t.shadowRoot.querySelectorAll("*"),i=Array.from(s).filter(function(e){return e.textContent&&"skip"===e.textContent.trim().toLowerCase()&&"SCRIPT"!==e.tagName&&"STYLE"!==e.tagName});t.updateMessageFormAndSendMessage("skip"),e.textContent="Skipped",e.disabled=!0,e.style.color="#adb5bd",e.style.cursor="not-allowed",e.style.opacity="0.6";var a=e.closest("form");a&&a.querySelectorAll("input, button").forEach(function(e){e.setAttribute("disabled","disabled")}),o.forEach(function(t){t!==e&&(t.textContent="Skipped",t.disabled=!0,t.style.color="#adb5bd",t.style.cursor="not-allowed",t.style.opacity="0.6")}),i.forEach(function(t){t!==e&&(t.textContent="Skipped","BUTTON"!==t.tagName&&"A"!==t.tagName||(t.disabled=!0,t.style.color="#adb5bd",t.style.cursor="not-allowed",t.style.opacity="0.6"))})})}),n.forEach(function(e){e.addEventListener("change",function(){var t=e.querySelector(".eapply-btn");t.removeAttribute("disabled"),t.classList.remove("button-disabled")})})}},{key:"isUserApplied",value:function(e){return["submit_success","already_applied","questions_complete","submitted","failed"].includes(e)}},{key:"handleSubmissionComplete",value:function(e,t){var n=this;e&&!["new","invited","started","questions_started","confirm_stop","declined","invalid_answers_limit_exceeded"].includes(e)&&(this.isUserApplied(e)?(this.applyWebContainer.querySelector(".completed").classList.add("complete"),this.applyWebContainer.querySelector(".apply-now").classList.add("applied"),document.querySelectorAll(".apply-btn").forEach(function(e){e.classList.add("applied"),e.innerText="Applied"}),this.applyWebContainer.querySelector(".apply-now").innerText="Applied",this.applyWebContainer.querySelector(".completed .eapply-btn").addEventListener("click",function(){n.dispatchEvent(new Event("submitted",{bubbles:!1}))}),t&&(this.applyWebContainer.querySelector("#complete-message").innerHTML=t)):this.applyWebContainer.remove(),console.log("appUserStatus",e))}},{key:"sendFile",value:function(e){var t=this;this.renderLoadingImage();var n=e.name||"Resume.pdf",o=new FormData;o.append("answer",e),o.append("daliaApplyToken",this.getUserToken()),window.fetch("".concat(this.options.baseUrl,"/").concat(this.options.submitPath),{method:"POST",body:o}).then(function(e){return e.json()}).then(function(e){if(t.restoreSendButton&&t.restoreSendButton(),"FORM_MODAL"===e.type){var o=t.extractResumeUrlFromResponse(e);if(o){var s=t.formatResumeAnswer(o,n);t.renderMessage(s,!0,e.appUserStatus,!0),setTimeout(function(){return t.hideResumeUploadForms()},100),t.removeLoadingIndicator&&t.removeLoadingIndicator(100)}return t.handleFormModal(e),t.removeLoadingIndicator&&t.removeLoadingIndicator(100),void(e.completed&&setTimeout(function(){t.removeLoadingIndicator&&t.removeLoadingIndicator(),t.sendMessage("FORM SUBMITTED")},300))}if("FORM_REVIEW"===e.type){var i=t.extractResumeUrlFromResponse(e);if(i){var a=t.formatResumeAnswer(i,n);t.renderMessage(a,!0,e.appUserStatus,!0),setTimeout(function(){return t.hideResumeUploadForms()},100)}return t.removeLoadingIndicator&&t.removeLoadingIndicator(),t.disableChatInput(),t.renderFormReview(e.formsData),void setTimeout(function(){t.enableReviewButtons(),t.disableChatInput()},100)}if("submitted"===e.appUserStatus||"SUBMITTED"===e.type)return t.removeLoadingIndicator&&t.removeLoadingIndicator(),void(e.message&&t.renderMessage(e.message,!1,e.appUserStatus));var r=t.extractResumeUrlFromResponse(e);if(t.removeLoadingIndicator&&t.removeLoadingIndicator(),r){var l=t.formatResumeAnswer(r,n);t.renderMessage(l,!0,e.appUserStatus,!0),setTimeout(function(){return t.hideResumeUploadForms()},100),e.message&&!e.message.includes(r)&&setTimeout(function(){t.renderMessage(e.message,!1,e.appUserStatus)},100)}else t.renderMessage(e.message,!1,e.appUserStatus);t.chatInput&&(t.chatInput.disabled=!1,t.sendButton&&(t.sendButton.disabled=!1))}).catch(function(e){t.removeLoadingIndicator&&t.removeLoadingIndicator(),t.restoreSendButton&&t.restoreSendButton(),console.error("Error uploading file:",e),t.renderMessage("An error occurred while uploading your resume. Please try again.",!1,null),t.chatInput&&(t.chatInput.disabled=!1,t.sendButton&&(t.sendButton.disabled=!1))})}},{key:"extractResumeUrlFromResponse",value:function(e){var t=e.resumeUrl;return"string"==typeof t&&t.includes("storage.googleapis.com")?t:null}},{key:"formatResumeAnswer",value:function(e,t){var n,o=String(e||"").replace(/"/g,"&quot;"),s=t||(null==e||null===(n=e.split("/").pop())||void 0===n?void 0:n.split("?")[0])||"Resume.pdf";s=function(e){if(!e)return"";var t=document.createElement("div");return t.textContent=String(e),t.innerHTML}(s);return'<div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; max-width: 100%;">\n      <div style="font-size: 32px; flex-shrink: 0;">'.concat("ðŸ“„",'</div>\n      <div style="flex: 1; min-width: 0;">\n        <div style="font-weight: 600; color: #212529; margin-bottom: 4px; word-break: break-word;">').concat(s,'</div>\n        <div style="font-size: 12px; color: #6c757d;">Resume uploaded successfully</div>\n      </div>\n      <a href="').concat(o,'" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: #6f00ff; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; font-weight: 500; white-space: nowrap; transition: background 0.2s;">\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n          <polyline points="7 10 12 15 17 10"></polyline>\n          <line x1="12" y1="15" x2="12" y2="3"></line>\n        </svg>\n        View\n      </a>\n    </div>')}},{key:"hideResumeUploadForms",value:function(){this.shadowRoot.querySelectorAll(".chat-messages form").forEach(function(e){if(e.querySelector('input[type="file"]')){var t=e.querySelector("label"),n=e.textContent||"",o=e.innerHTML||"";if(n.toLowerCase().includes("resume")||n.includes("%{resume_upload_link}")||o.includes("resume_upload")||t&&(t.textContent.toLowerCase().includes("resume")||t.textContent.includes("%{resume_upload_link}"))){var s=e.closest(".bubble-container");s?s.style.display="none":e.style.display="none"}}})}},{key:"checkAndHideResumeUploadForms",value:function(){var e=this.shadowRoot.querySelectorAll(".chat-messages .bubble-container"),t=!1;e.forEach(function(e){var n=e.textContent||"",o=e.innerHTML||"";(n.includes("storage.googleapis.com")||n.includes("file-upload/resume/")||n.includes("/resume/")||o.includes("Resume uploaded successfully")||e.querySelector('a[href*="resume"]')||e.querySelector('a[href*="storage.googleapis.com"]'))&&(t=!0)}),t&&this.hideResumeUploadForms()}},{key:"initializeSearchableSelects",value:function(){var e=this,t=this.shadowRoot.querySelectorAll('input[data-searchable-select="true"]');Array.from(t).filter(function(e){return!e.hasAttribute("data-initialized")}).length>0&&this.disableChatInput(),t.forEach(function(t){if(!t.hasAttribute("data-initialized")){var n=t.closest(".searchable-select-container"),o=n.querySelector(".searchable-select-dropdown"),s=o.querySelector(".searchable-select-options"),i=n.querySelector('input[name="answer"]'),a=n.parentElement.querySelector("button.eapply-btn"),r=[];try{var l=t.getAttribute("data-options");r=JSON.parse(l.replace(/&quot;/g,'"'))}catch(e){return void console.error("Failed to parse searchable select options:",e)}t.setAttribute("data-initialized","true"),t.removeAttribute("readonly"),t.addEventListener("focus",function(e){e.preventDefault(),e.stopPropagation(),t.style.transform="translateY(-1px)"}),t.addEventListener("blur",function(){setTimeout(function(){t.style.transform="translateY(0)"},200)}),t.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation(),e.disableChatInput(),e.showDropdown(o,s,r,t,i,a)}),t.addEventListener("input",function(n){if(!t.hasAttribute("data-selecting")){var l=n.target.value.toLowerCase();e.filterOptions(s,r,l,t,i,a),e.showDropdown(o,s,r,t,i,a)}});var c=function(t){n.contains(t.target)||o.contains(t.target)||o.classList.contains("show")&&e.hideDropdown(o)};document.addEventListener("click",c,!0),o.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault()}),e.addEventListener("remove",function(){document.removeEventListener("click",c,!0)})}})}},{key:"showDropdown",value:function(e,t,n,o,s,i){if(0!==n.length){var a=o.value.toLowerCase();this.filterOptions(t,n,a,o,s,i);var r=o.getBoundingClientRect(),l=Math.min(300,52*n.length),c=window.innerHeight-r.bottom,d=r.top,u=o.closest(".eapply-popup"),p=u?u.getBoundingClientRect():null,h=c<l&&d>c;if(p){var m=r.top-p.top,v=p.bottom-r.bottom;h&&m<l&&(h=!1),!h&&v<l&&(h=!0)}h?(e.style.top="auto",e.style.bottom="calc(100% + 2px)",e.style.borderRadius="8px 8px 0 0",e.style.transformOrigin="bottom center"):(e.style.top="calc(100% + 2px)",e.style.bottom="auto",e.style.borderRadius="8px",e.style.transformOrigin="top center"),e.classList.add("show"),e.style.setProperty("display","block","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("transform","translateY(0)","important"),e.style.setProperty("pointer-events","auto","important"),this.disableChatInput(),e.offsetHeight}}},{key:"hideDropdown",value:function(e){e.classList.remove("show"),e.style.setProperty("opacity","0","important"),e.style.setProperty("transform","translateY(-10px)","important"),e.style.setProperty("pointer-events","none","important"),e.style.setProperty("display","none","important"),e.style.setProperty("visibility","hidden","important");var t=this.shadowRoot.querySelectorAll('input[data-searchable-select="true"]:not([disabled])').length>0,n=this.shadowRoot.querySelectorAll(".chat-messages form:not([data-form-submitted])").length>0,o=this.shadowRoot.querySelector(".form-review-container");t||n||o||this.enableChatInput()}},{key:"disableChatInput",value:function(){this.options.autoHideChatInput&&this.chatInputContainer&&this.chatInputContainer.classList.add("hide"),this.chatInput&&(this.chatInput.disabled=!0,this.chatInput.placeholder="Complete your selection first...",this.chatInput.style.opacity="0.5",this.chatInput.style.cursor="not-allowed",this.chatInput.setAttribute("disabled","disabled"),this.sendButton&&(this.sendButton.disabled=!0,this.sendButton.style.opacity="0.5",this.sendButton.style.cursor="not-allowed"))}},{key:"enableChatInput",value:function(){this.chatInputContainer&&this.chatInputContainer.classList.remove("hide"),this.chatInput&&(this.chatInput.disabled=!1,this.chatInput.placeholder="Type your message...",this.chatInput.style.opacity="1",this.chatInput.style.cursor="text",this.sendButton&&(this.sendButton.disabled=!1,this.sendButton.style.opacity="1",this.sendButton.style.cursor="pointer"))}},{key:"filterOptions",value:function(e,t,n,s,i,a){var r=this;e.innerHTML="";var l=this.enhancedSearch(t,n),c=l.slice(0,50);if(!n){var d=document.createElement("div");d.className="searchable-search-header",d.innerHTML='\n        <div class="search-results-info">\n          <span class="results-count">'.concat(c.length," option").concat(1!==c.length?"s":"",' available</span>\n          <span class="search-term">Type to search</span>\n        </div>\n      '),e.appendChild(d);var u=s.getAttribute("data-question-context")||"",p=this.groupOptionsByType(c,u);Object.entries(p).forEach(function(t){var n=(0,o.Z)(t,2),l=n[0],c=n[1];if(c.length>0){var d=document.createElement("div");d.className="searchable-group-header",d.textContent=l,e.appendChild(d)}c.forEach(function(t,n){var o=document.createElement("div");o.className="searchable-option",o.dataset.value=t.value,o.dataset.index=n;var l=r.createEnhancedOptionDisplay(t,"",u);o.innerHTML=l,o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),r.selectOption(t,s,i,a)}),o.addEventListener("mouseenter",function(){e.querySelectorAll(".searchable-option").forEach(function(e){e.classList.remove("selected")}),o.classList.add("selected")}),e.appendChild(o)})});var h=document.createElement("div");return h.className="searchable-keyboard-hint",h.innerHTML='\n        <div class="keyboard-shortcuts">\n          <span class="shortcut"><kbd>Enter</kbd> Select</span>\n          <span class="shortcut"><kbd>Esc</kbd> Close</span>\n        </div>\n      ',void e.appendChild(h)}if(n&&l.length>0){var m=document.createElement("div");m.className="searchable-search-header",m.innerHTML='\n        <div class="search-results-info">\n          <span class="results-count">'.concat(l.length," result").concat(1!==l.length?"s":"",' found</span>\n          <span class="search-term">for "').concat(n,'"</span>\n        </div>\n      '),e.appendChild(m)}var v=s.getAttribute("data-question-context")||"",f=this.groupOptionsByType(c,v);if(Object.entries(f).forEach(function(t){var l=(0,o.Z)(t,2),c=l[0],d=l[1];if(d.length>0){var u=document.createElement("div");u.className="searchable-group-header",u.textContent=c,e.appendChild(u)}d.forEach(function(t,o){var l=document.createElement("div");l.className="searchable-option",l.dataset.value=t.value,l.dataset.index=o;var c=r.createEnhancedOptionDisplay(t,n,v);l.innerHTML=c,l.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),r.selectOption(t,s,i,a)}),l.addEventListener("mouseenter",function(){e.querySelectorAll(".searchable-option").forEach(function(e){e.classList.remove("selected")}),l.classList.add("selected")}),e.appendChild(l)})}),0===l.length){var y=document.createElement("div");y.className="searchable-no-results",y.innerHTML='\n        <div class="no-results-icon">ðŸ”</div>\n        <div class="no-results-text">\n          <div class="no-results-title">No options found matching "'.concat(n,'"</div>\n          <div class="no-results-suggestions">\n            <div class="suggestion-title">Try these suggestions:</div>\n            <ul class="suggestion-list">\n              <li>Check your spelling</li>\n              <li>Try a shorter search term</li>\n              <li>Use partial names (e.g., "Alabama" instead of "Alabama A&M")</li>\n              <li>Select "Other" if your school isn\'t listed</li>\n            </ul>\n          </div>\n        </div>\n      '),e.appendChild(y)}if(l.length>50){var g=document.createElement("div");g.className="searchable-more-info",g.innerHTML='\n        <div class="more-results-info">\n          <span class="showing-text">Showing first 50 of '.concat(l.length,' results</span>\n          <span class="narrow-text">Type more to narrow your search</span>\n        </div>\n      '),e.appendChild(g)}if(1===l.length&&l[0].text.toLowerCase()===n.toLowerCase()){var b=e.querySelector(".searchable-option");b&&b.classList.add("selected")}if(l.length>0){var w=document.createElement("div");w.className="searchable-keyboard-hint",w.innerHTML='\n        <div class="keyboard-shortcuts">\n          <span class="shortcut"><kbd>Enter</kbd> Select</span>\n          <span class="shortcut"><kbd>Esc</kbd> Close</span>\n        </div>\n      ',e.appendChild(w)}}},{key:"enhancedSearch",value:function(e,t){var n=this;if(!t)return e.slice(0,50);var o=t.toLowerCase().trim(),s=[];return e.forEach(function(e){var t=e.text.toLowerCase(),i=e.value.toLowerCase();t===o||i===o?s.unshift(g(g({},e),{},{score:100,matchType:"exact"})):t.startsWith(o)||i.startsWith(o)?s.push(g(g({},e),{},{score:90,matchType:"starts-with"})):t.includes(o)||i.includes(o)?s.push(g(g({},e),{},{score:80,matchType:"contains"})):n.hasWordBoundaryMatch(t,o)&&s.push(g(g({},e),{},{score:70,matchType:"word-boundary"}))}),s.sort(function(e,t){return t.score-e.score}),s}},{key:"hasWordBoundaryMatch",value:function(e,t){return e.split(/\s+/).some(function(e){return e.startsWith(t)})}},{key:"groupOptionsByType",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"").toLowerCase();return t.includes("school")||t.includes("university")||t.includes("college")||t.includes("education")?this.groupBySchoolType(e):t.includes("major")||t.includes("degree")||t.includes("field of study")?this.groupByDegreeType(e):t.includes("job title")||t.includes("position")||t.includes("role")?this.groupByJobCategory(e):{Options:e}}},{key:"groupBySchoolType",value:function(e){var t={Universities:[],Colleges:[],"High Schools":[],"Technical Schools":[],Other:[]};return e.forEach(function(e){var n=e.text.toLowerCase();n.includes("university")?t.Universities.push(e):n.includes("college")?t.Colleges.push(e):n.includes("high school")||n.includes("high")?t["High Schools"].push(e):n.includes("technical")||n.includes("tech")||n.includes("institute")?t["Technical Schools"].push(e):t.Other.push(e)}),Object.keys(t).forEach(function(e){0===t[e].length&&delete t[e]}),t}},{key:"groupByDegreeType",value:function(e){var t={"Bachelor's Degrees":[],"Master's Degrees":[],"Associate's Degrees":[],"Certificates & Diplomas":[],Other:[]};return e.forEach(function(e){var n=e.text.toLowerCase();n.includes("bachelor")||n.includes("ba ")||n.includes("bs ")||n.includes("b.s.")||n.includes("b.a.")?t["Bachelor's Degrees"].push(e):n.includes("master")||n.includes("ma ")||n.includes("ms ")||n.includes("m.s.")||n.includes("m.a.")?t["Master's Degrees"].push(e):n.includes("associate")||n.includes("aa ")||n.includes("as ")||n.includes("a.s.")||n.includes("a.a.")?t["Associate's Degrees"].push(e):n.includes("certificate")||n.includes("diploma")||n.includes("certification")?t["Certificates & Diplomas"].push(e):t.Other.push(e)}),Object.keys(t).forEach(function(e){0===t[e].length&&delete t[e]}),t}},{key:"groupByJobCategory",value:function(e){var t={Management:[],Technical:[],Administrative:[],"Sales & Marketing":[],Other:[]};return e.forEach(function(e){var n=e.text.toLowerCase();n.includes("manager")||n.includes("director")||n.includes("supervisor")||n.includes("lead")||n.includes("chief")?t.Management.push(e):n.includes("engineer")||n.includes("developer")||n.includes("analyst")||n.includes("specialist")||n.includes("technician")?t.Technical.push(e):n.includes("assistant")||n.includes("coordinator")||n.includes("administrator")||n.includes("clerk")?t.Administrative.push(e):n.includes("sales")||n.includes("marketing")||n.includes("representative")||n.includes("account")?t["Sales & Marketing"].push(e):t.Other.push(e)}),Object.keys(t).forEach(function(e){0===t[e].length&&delete t[e]}),t}},{key:"createEnhancedOptionDisplay",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=e.text;if(t){var s=new RegExp("(".concat(t,")"),"gi");o=e.text.replace(s,'<strong class="highlight">$1</strong>')}var i="",a=n.toLowerCase();return i=a.includes("school")||a.includes("university")||a.includes("college")||a.includes("education")?e.text.toLowerCase().includes("university")?'<span class="type-indicator university">ðŸ›ï¸</span>':e.text.toLowerCase().includes("college")?'<span class="type-indicator college">ðŸŽ“</span>':e.text.toLowerCase().includes("high school")?'<span class="type-indicator high-school">ðŸ«</span>':e.text.toLowerCase().includes("technical")?'<span class="type-indicator technical">âš™ï¸</span>':'<span class="type-indicator other">ðŸ”</span>':a.includes("major")||a.includes("degree")||a.includes("field of study")?e.text.toLowerCase().includes("bachelor")||e.text.toLowerCase().includes("master")||e.text.toLowerCase().includes("associate")?'<span class="type-indicator degree">ðŸŽ“</span>':e.text.toLowerCase().includes("certificate")?'<span class="type-indicator certificate">ðŸ“œ</span>':'<span class="type-indicator other">ðŸ“š</span>':a.includes("job title")||a.includes("position")||a.includes("role")?e.text.toLowerCase().includes("manager")||e.text.toLowerCase().includes("director")?'<span class="type-indicator management">ðŸ‘”</span>':e.text.toLowerCase().includes("engineer")||e.text.toLowerCase().includes("developer")?'<span class="type-indicator technical">ðŸ’»</span>':e.text.toLowerCase().includes("assistant")||e.text.toLowerCase().includes("coordinator")?'<span class="type-indicator admin">ðŸ“‹</span>':'<span class="type-indicator job">ðŸ’¼</span>':a.includes("location")||a.includes("city")||a.includes("state")?'<span class="type-indicator location">ðŸ“</span>':'<span class="type-indicator default">ðŸ“</span>','\n      <div class="option-content">\n        <div class="option-main">\n          '.concat(i,'\n          <span class="option-text">').concat(o,"</span>\n        </div>\n      </div>\n    ")}},{key:"selectOption",value:function(e,t,n,o){t.setAttribute("data-selecting","true"),t.value=e.text,n.value=e.value,t.style.borderColor="#48bb78",t.style.boxShadow="0 0 0 4px rgba(72, 187, 120, 0.1)",o&&(o.classList.remove("button-disabled"),o.style.animation="buttonPulse 0.6s ease-out");var s=t.closest(".searchable-select-container").querySelector(".searchable-select-dropdown");s&&(s.classList.remove("show"),s.style.setProperty("display","none","important"),s.style.setProperty("visibility","hidden","important"),s.style.setProperty("opacity","0","important"),s.style.setProperty("pointer-events","none","important"),s.style.setProperty("transform","translateY(-10px)","important")),setTimeout(function(){t.removeAttribute("data-selecting")},100),setTimeout(function(){t.style.borderColor="",t.style.boxShadow=""},2e3),t.focus()}},{key:"renderFormReview",value:function(e){var t=this;this.currentFormsData=e,this.shadowRoot.querySelectorAll(".form-review-container").forEach(function(e){var t=e.closest(".bubble-container");t?t.remove():e.remove()});var n=e.length,o=e.filter(function(e){return e.completed}).length,s=e.filter(function(e){return e.edited}).length,i='\n      <div class="form-review-container">\n        <div class="form-review-header">\n          <h2>Review Your Application</h2>\n          <div class="form-review-summary">\n            <div class="review-summary-item">\n              <span class="review-summary-label">Forms Completed:</span>\n              <span class="review-summary-value">'.concat(o," of ").concat(n,"</span>\n            </div>\n            ").concat(s>0?'\n            <div class="review-summary-item review-summary-edited">\n              <span class="review-summary-label">Forms Edited:</span>\n              <span class="review-summary-value">'.concat(s,"</span>\n            </div>\n            "):"","\n          </div>\n        </div>\n    ");e.forEach(function(e){var n=t.groupFormItemsByMessage(e.items),o="";n.forEach(function(e){e.questions.length>0&&e.questions.forEach(function(e){var t=e.question||"Question will be here",n=e.answer||"Not answered",s=e.isSkipped||"Skipped"===n||"No answer provided"===n;o+='\n              <div class="form-sidebar-answer-item" data-question-id="'.concat(e.id,'">\n                <div class="form-sidebar-answer-content">\n                  <div class="form-sidebar-answer-label">').concat(t,'</div>\n                  <div class="form-sidebar-answer-value ').concat(s?"form-sidebar-answer-skipped":"",'">').concat(n,"</div>\n                </div>\n              </div>\n            ")})});var s=e.edited?'<div class="form-status-badge form-status-edited"><span>Edited</span></div>':'<div class="form-status-badge form-status-completed"><span>Completed</span></div>',a=e.totalQuestions>0?"".concat(e.answeredQuestions," of ").concat(e.totalQuestions," questions answered"):"All questions answered";i+='\n        <div class="form-sidebar-item form-review-item" data-form-id="'.concat(e.formId,'">\n          <div class="form-sidebar-header">\n            <div class="form-sidebar-icon">\n              <svg width="34" height="34" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n                <path d="M14 2V8H20" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M16 13H8" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M16 17H8" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n            </div>\n            <div class="form-sidebar-title">\n              <div class="form-sidebar-name-row">\n              <div class="form-sidebar-name">').concat(e.formName,"</div>\n                ").concat(s,'\n              </div>\n              <div class="form-sidebar-instruction">').concat(a,'. Click "Edit Form" to make changes.</div>\n            </div>\n          </div>\n          <div class="form-review-edit-section"><button class="form-review-edit-btn" data-form-id="').concat(e.formId,'" title="Edit ').concat(e.formName,'"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span>Edit Form</span></button></div>\n          <div class="form-sidebar-answers-container">\n            ').concat(o,"\n          </div>\n        </div>\n      ")}),i+='\n      <div class="review-actions">\n        <div class="review-actions-content">\n          <div class="review-actions-info">\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n              <path d="M12 16V12M12 8H12.01" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n            <span>Review your answers above. Click "Edit Form" on any form to make changes before submitting.</span>\n          </div>\n          <button class="submit-application-btn">\n            <span>Submit Form</span>\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n    </div>',this.renderMessage(i,!1),this.disableChatInput(),window.requestAnimationFrame(function(){var e=t.shadowRoot.querySelector(".chat-messages .content");if(e){t._reviewClickHandler&&e.removeEventListener("click",t._reviewClickHandler);t._reviewClickHandler=function(e){var n=e.target.closest(".form-review-edit-btn");if(n){var o;if(n.disabled||"0.5"===n.style.opacity)return e.stopPropagation(),void e.preventDefault();e.stopPropagation(),e.preventDefault();var s=n.getAttribute("data-form-id"),i=null===(o=t.currentFormsData)||void 0===o?void 0:o.find(function(e){return e.formId==s});if(i){t.disableReviewButtons();var a=g(g({},i),{},{isEditMode:!0,completed:!0});t.renderFormModal(a)}}else{var r=e.target.closest(".submit-application-btn");if(r){if(r.disabled||"0.5"===r.style.opacity)return e.stopPropagation(),void e.preventDefault();e.stopPropagation(),e.preventDefault(),t.submitApplicationWithEdits()}}},e.addEventListener("click",t._reviewClickHandler)}})}},{key:"startEditingAnswer",value:function(e,t){var n=this,o=this.getQuestionData(e,t);if(o){var s=this.shadowRoot.querySelector('[data-question-id="'.concat(e,'"]'));if(s){var i=s.querySelector(".answer-container");if(i){var a=this.getQuestionOptions(o),r="";if(a&&a.length>0){var l=o.required||!1;r='\n                  <div class="edit-answer-container">\n                    <select class="edit-answer-select" data-question-id="'.concat(e,'">\n                      <option value="">Select an answer...</option>\n                      ').concat(l?"":'<option value="skip">Skip this question</option>',"\n                      ").concat(a.map(function(e){var t=o.answer===e.label||o.answer===e.value;return'<option value="'.concat(e.value,'" ').concat(t?"selected":"",">").concat(e.label,"</option>")}).join(""),'\n                    </select>\n                    <div class="edit-actions">\n                      <button class="save-answer-btn" data-question-id="').concat(e,'">Save</button>\n                      <button class="cancel-edit-btn" data-question-id="').concat(e,'">Cancel</button>\n                    </div>\n                  </div>\n                ')}else{var c=o.required||!1;r='\n                  <div class="edit-answer-container">\n                    <textarea class="edit-answer-textarea" data-question-id="'.concat(e,'" placeholder="Enter your answer...">').concat("Skipped"===o.answer||"No answer provided"===o.answer?"":o.answer,'</textarea>\n                    <div class="edit-actions">\n                      <button class="save-answer-btn" data-question-id="').concat(e,'">Save</button>\n                      <button class="cancel-edit-btn" data-question-id="').concat(e,'">Cancel</button>\n                      ').concat(c?"":'<button class="skip-answer-btn" data-question-id="'.concat(e,'">Skip</button>'),"\n                    </div>\n                  </div>\n                ")}i.innerHTML=r;var d=i.querySelector(".save-answer-btn"),u=i.querySelector(".cancel-edit-btn"),p=i.querySelector(".skip-answer-btn");d&&d.addEventListener("click",function(o){n.saveEditedAnswer(e,t)}),u&&u.addEventListener("click",function(o){n.cancelEditAnswer(e,t)}),p&&p.addEventListener("click",function(o){n.skipEditedAnswer(e,t)})}else console.error("Answer container not found")}else console.error("Question element not found for ID:",e)}else console.error("Question data not found for ID:",e)}},{key:"getQuestionData",value:function(e,t){var n,o=v(t);try{for(o.s();!(n=o.n()).done;){var s,i=v(n.value.items);try{for(i.s();!(s=i.n()).done;){var a=s.value;if("QUESTION"===a.type&&a.id==e)return a}}catch(e){i.e(e)}finally{i.f()}}}catch(e){o.e(e)}finally{o.f()}return null}},{key:"getQuestionOptions",value:function(e){return e.questionOptions&&e.questionOptions.length>0?e.questionOptions.filter(function(e){return"Select"!==e.value&&"Select"!==e.label&&"-1"!==e.value&&"-1"!==e.label}).map(function(e){return{value:e.value||e.label,label:e.label||e.value}}):null}},{key:"saveEditedAnswer",value:function(e,t){var n=this.shadowRoot.querySelector('[data-question-id="'.concat(e,'"]'));if(n){var o=n.querySelector(".edit-answer-container");if(o){var s="",i=o.querySelector(".edit-answer-select"),a=o.querySelector(".edit-answer-textarea");if(i?s=i.value:a&&(s=a.value.trim()),s){var r,l=v(t);try{for(l.s();!(r=l.n()).done;){var c,d=v(r.value.items);try{for(d.s();!(c=d.n()).done;){var u=c.value;if("QUESTION"===u.type&&u.id==e){u.answer="skip"===s?"Skipped":s,u.isSkipped="skip"===s;break}}}catch(e){d.e(e)}finally{d.f()}}}catch(e){l.e(e)}finally{l.f()}this.storeEditedAnswer(e,s),this.renderAnswerDisplay(n,"skip"===s?"Skipped":s,"skip"===s)}else alert('Please provide an answer or select "Skip this question"')}}}},{key:"skipEditedAnswer",value:function(e,t){this.saveEditedAnswer(e,t,"skip")}},{key:"cancelEditAnswer",value:function(e,t){var n=this.shadowRoot.querySelector('[data-question-id="'.concat(e,'"]'));if(n){var o,s="",i=v(t);try{for(i.s();!(o=i.n()).done;){var a,r=v(o.value.items);try{for(r.s();!(a=r.n()).done;){var l=a.value;if("QUESTION"===l.type&&l.id==e){s=l.answer;break}}}catch(e){r.e(e)}finally{r.f()}}}catch(e){i.e(e)}finally{i.f()}this.renderAnswerDisplay(n,s,"Skipped"===s)}}},{key:"renderAnswerDisplay",value:function(e,t,n){var o=this,s=e.querySelector(".answer-container");if(s){var i=n?"answer-text skipped":"answer-text";s.innerHTML='\n                <div class="'.concat(i,'">').concat(t,'</div>\n                <button class="edit-answer-btn" data-question-id="').concat(e.getAttribute("data-question-id"),'">Edit</button>\n              ');var a=s.querySelector(".edit-answer-btn");a&&a.addEventListener("click",function(e){var t=e.target.getAttribute("data-question-id");o.startEditingAnswer(t,o.currentFormsData)})}}},{key:"storeEditedAnswer",value:function(e,t){this.editedAnswers||(this.editedAnswers={}),this.editedAnswers[e]=t}},{key:"submitApplicationWithEdits",value:function(){this.disableReviewButtons();var e=[{review_confirmed:!0,editedAnswers:this.editedAnswers||{}}];this.sendMessage(JSON.stringify(e))}},{key:"attachEditButtonListeners",value:function(e){var t=this;this.shadowRoot.querySelectorAll(".edit-answer-btn").forEach(function(n){n.addEventListener("click",function(n){var o=n.target.getAttribute("data-question-id");t.startEditingAnswer(o,e)})})}},{key:"renderMessageGroup",value:function(e){if(0===e.length)return"";var t='<div class="questions-section">\n                <div class="questions-header">Questions:</div>';return e.forEach(function(e,n){var o=e.isSkipped?"question-item skipped":"question-item",s=e.isSkipped?"answer-text skipped":"answer-text";t+='<div class="'.concat(o,'" data-question-id="').concat(e.id,'">\n                  <div class="question-text">').concat(n+1,". ").concat(e.question,'</div>\n                  <div class="answer-container">\n                    <div class="').concat(s,'">').concat(e.answer,'</div>\n                    <button class="edit-answer-btn" data-question-id="').concat(e.id,'">Edit</button>\n                  </div>\n                </div>')}),t+="</div>"}},{key:"lockBodyScroll",value:function(){var e=document.body,t=document.documentElement;this._scrollPosition=window.pageYOffset||document.documentElement.scrollTop,e.style.position="fixed",e.style.top="-".concat(this._scrollPosition,"px"),e.style.width="100%",e.style.overflow="hidden",t.style.overflow="hidden"}},{key:"unlockBodyScroll",value:function(){var e=document.body,t=document.documentElement;e.style.position="",e.style.top="",e.style.width="",e.style.overflow="",t.style.overflow="",void 0!==this._scrollPosition&&(window.scrollTo(0,this._scrollPosition),this._scrollPosition=void 0)}},{key:"applyTruncationState",value:function(e,t){if(e){var n=e.querySelector(".form-modal-content"),o=e.querySelector(".form-modal-message-section:first-of-type");t?(n&&(n.classList.add("content-truncated"),n.classList.remove("content-expanded")),o&&(o.classList.add("message-truncated"),o.classList.remove("message-expanded"))):(n&&(n.classList.remove("content-truncated"),n.classList.add("content-expanded")),o&&(o.classList.remove("message-truncated"),o.classList.add("message-expanded")))}}},{key:"collapseFormContent",value:function(e,t,n,o){var s=e.querySelectorAll(".form-modal-message-section"),i=e.querySelectorAll(".form-modal-questions-section");s.forEach(function(e,t){t>0&&(e.style.display="none")}),i.forEach(function(e){e.style.display="none"}),this.applyTruncationState(e,!0),t.querySelector(".continue-reading-text").textContent="Continue reading",n&&(n.style.transform="rotate(0deg)");var a=e.querySelector(".form-modal-finish-wrapper");a&&(a.style.display="none"),o&&(o.disabled=!0)}},{key:"expandFormContent",value:function(e,t,n,o){var s=e.querySelectorAll(".form-modal-message-section"),i=e.querySelectorAll(".form-modal-questions-section");s.forEach(function(e){e.style.display="block"}),i.forEach(function(e){e.style.display="flex"}),this.applyTruncationState(e,!1),t.querySelector(".continue-reading-text").textContent="Show less",n&&(n.style.transform="rotate(180deg)");var a=e.querySelector(".form-modal-finish-wrapper");a&&(a.style.display="flex",a.style.opacity="1",a.style.zIndex="10",a.style.visibility="visible"),o&&(o.disabled=!1),i.length>0&&setTimeout(function(){i[0].scrollIntoView({behavior:"smooth",block:"start"})},100),setTimeout(function(){window.dispatchEvent(new Event("resize"))},200)}},{key:"handleFormModal",value:function(e){this.disableChatInput(),e.completed?this.renderFormSidebar(e,!0):this.renderFormSidebar(e,!1)}},{key:"renderFormSidebar",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.shadowRoot.querySelector(".chat-messages .content");if(o){var s=o.querySelector('.form-wrapper[data-form-id="'.concat(e.formId,'"]'));s||((s=document.createElement("div")).className="form-wrapper",s.setAttribute("data-form-id",e.formId),o.appendChild(s));var i=s.querySelector(".apply-sidebar-container");i||((i=document.createElement("div")).className="apply-sidebar-container",s.appendChild(i));var a="";if(n){var r=e.items.filter(function(e){return"QUESTION"===e.type}),l="";r.forEach(function(e){var t=e.question||"Question will be here",n=e.answer||"Not answered",o=e.isSkipped||"Skipped"===n||"No answer provided"===n;l+='\n          <div class="form-sidebar-answer-item" data-question-id="'.concat(e.id,'">\n            <div class="form-sidebar-answer-content">\n              <div class="form-sidebar-answer-label">').concat(t,'</div>\n              <div class="form-sidebar-answer-value ').concat(o?"form-sidebar-answer-skipped":"",'">').concat(n,"</div>\n            </div>\n          </div>\n        ")}),a='\n        <div class="form-sidebar-item" data-form-id="'.concat(e.formId,'">\n          <div class="form-sidebar-header">\n            <div class="form-sidebar-icon">\n              <svg width="34" height="34" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n                <path d="M14 2V8H20" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M16 13H8" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M16 17H8" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n            </div>\n            <div class="form-sidebar-title">\n              <div class="form-sidebar-name">').concat(e.formName,' *</div>\n              <div class="form-sidebar-instruction">Please read the information in this form, then answer the questions that follow.</div>\n            </div>\n          </div>\n          <div class="form-sidebar-read-success">\n            <span class="form-sidebar-read-success-text">*Read Successfully</span>\n            <svg class="form-sidebar-read-success-check" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <circle cx="12" cy="12" r="10" stroke="#10B981" stroke-width="2" fill="none"/>\n              <path d="M9 12L11 14L15 10" stroke="#10B981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n          </div>\n          <div class="form-sidebar-edit-note">\n            <p>You can edit your answers in the review step at the end of the application.</p>\n          </div>\n          <div class="form-sidebar-answers-container">\n            ').concat(l,"\n          </div>\n        </div>\n      ")}else a='\n        <div class="form-sidebar-item form-sidebar-item-initial" data-form-id="'.concat(e.formId,'">\n          <div class="form-sidebar-header">\n            <div class="form-sidebar-icon">\n              <svg width="34" height="34" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n                <path d="M14 2V8H20" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M16 13H8" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M16 17H8" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n            </div>\n            <div class="form-sidebar-title">\n              <div class="form-sidebar-name">').concat(e.formName,' *</div>\n              <div class="form-sidebar-instruction">Please read the information in this form, then answer the questions that follow.</div>\n            </div>\n          </div>\n          <button class="form-sidebar-read-btn" data-form-id="').concat(e.formId,'">\n            <span>Read the form (Required)</span>\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n          </button>\n          <div class="form-sidebar-note">*Reading the form is required to continue</div>\n        </div>\n      ');var c=i.querySelector('[data-form-id="'.concat(e.formId,'"]'));if(c?c.outerHTML=a:i.insertAdjacentHTML("beforeend",a),n);else{var d=i.querySelector('.form-sidebar-read-btn[data-form-id="'.concat(e.formId,'"]'));d&&d.addEventListener("click",function(){t.renderFormModal(e)})}setTimeout(function(){var t=i.querySelector('[data-form-id="'.concat(e.formId,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})},100)}else console.warn("Chat messages content not found")}},{key:"groupFormItemsByMessage",value:function(e){if(!e||!Array.isArray(e))return[];var t=[],n=null;return e.forEach(function(e){"MESSAGE"===e.type?(n&&t.push(n),n={message:e,questions:[]}):"QUESTION"===e.type&&(n?n.questions.push(e):n={message:null,questions:[e]})}),n&&t.push(n),t}},{key:"renderFormModal",value:function(e){var t,n=this;this.lockBodyScroll();var o=document.createElement("div");o.className="form-modal-overlay",o.id="form-modal-".concat(e.formId);var s=this.groupFormItemsByMessage(e.items||[]),i=(e.items||[]).filter(function(e){return"QUESTION"===e.type}),a=!0===e.readOnly,r=!0===e.isEditMode,l='\n      <div class="form-modal-container">\n        <div class="form-modal-header">\n          <h2 class="form-modal-title">'.concat(e.formName,'</h2>\n          <button class="form-modal-close" data-form-id="').concat(e.formId,'">\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n          </button>\n        </div>\n        ').concat(r?'\n        <div class="form-modal-content-container">\n          <div class="form-modal-warning-container">\n            <div class="form-modal-warning" style="background: #F3F4F6; border: 1px solid #6f00ff;">\n              <div class="form-modal-warning-icon">\n                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                  <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                </svg>\n              </div>\n              <div class="form-modal-warning-text" style="color: #1F2937;">Edit your answers below. Click "Save Changes" to update your form.</div>\n            </div>\n          </div>\n          ':'\n        <div class="form-modal-content-container">\n          <div class="form-modal-warning-container">\n            <div class="form-modal-warning">\n              <div class="form-modal-warning-icon">\n                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <circle cx="12" cy="12" r="11" stroke="#F4AD28" stroke-width="1.5" fill="none"/>\n                  <circle cx="12" cy="8" r="1.5" fill="#F4AD28"/>\n                  <path d="M12 10V16" stroke="#F4AD28" stroke-width="2" stroke-linecap="round"/>\n                </svg>\n              </div>\n              <div class="form-modal-warning-text">You can not continue applying without reading this form</div>\n            </div>\n          </div>\n        ','\n          <div class="form-modal-content">\n    '),c=r||e.completed,d=s.some(function(e){return e.message}),u=s.filter(function(e){return e.message}).length>1,p=s.some(function(e,t){return t>0&&e.questions.length>0}),h=(null===(t=s[0])||void 0===t?void 0:t.questions)&&s[0].questions.length>0,m=u||p||h,v=!0;s.forEach(function(e,t){if(e.message){var n=c||0===t?"display: block;":"display: none;";l+='\n          <div class="form-modal-message-section" data-group-index="'.concat(t,'" style="').concat(n,'">\n            <div class="form-modal-message">').concat(e.message.content,"</div>\n          </div>\n        "),v&&!c&&m&&(l+='\n            <div class="form-modal-message-continue">\n              <button class="form-modal-message-continue-btn" id="continue-reading-all-btn">\n                <span class="continue-reading-text">Continue reading</span>\n                <div class="continue-reading-arrow">\n                  <svg width="15" height="15" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M6 9L12 15L18 9" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                  </svg>\n                </div>\n              </button>\n            </div>\n          '),v=!1}if(e.questions.length>0){var o=c||!e.message&&!d&&0===t?"display: flex;":"display: none;";l+='<div class="form-modal-questions-section" data-group-index="'.concat(t,'" style="').concat(o,'">'),e.questions.forEach(function(e,t){var n=e.required?"*":"";l+='\n            <div class="form-modal-question" data-question-id="'.concat(e.id,'">\n              ').concat(t>0?'<div class="form-modal-question-divider"></div>':"",'\n              <div class="form-modal-question-label">').concat(e.question||"Question will be here").concat(n,'</div>\n              <div class="form-modal-question-answer">\n          '),e.questionOptions&&e.questionOptions.length>0?e.questionOptions.forEach(function(t){var n=e.answer===t.value||e.answer===t.label;l+='\n                <label class="form-modal-option '.concat(a?"form-modal-option-readonly":"",'">\n                  <input type="radio" name="question_').concat(e.id,'" value="').concat(t.value,'" ').concat(n?"checked":""," ").concat(a?"disabled":"",' style="display: none;">\n                  <div class="form-modal-check-circle ').concat(n?"checked":""," ").concat(a?"form-modal-check-circle-readonly":"",'">\n                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>\n                      ').concat(n?'<path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>':"","\n                    </svg>\n                  </div>\n                  <span>").concat(t.label||t.value,"</span>\n                </label>\n              ")}):l+='\n              <input type="text" class="form-modal-text-input '.concat(a?"form-modal-text-input-readonly":"",'"\n                     data-question-id="').concat(e.id,'"\n                     value="').concat(e.answer&&"Skipped"!==e.answer?e.answer:"",'"\n                     ').concat(a?"readonly":"",'\n                     placeholder="Enter your answer...">\n            '),l+="\n              </div>\n            </div>\n          "}),l+="</div>",d||0!==t||c||!m||(l+='\n            <div class="form-modal-message-continue">\n              <button class="form-modal-message-continue-btn" id="continue-reading-all-btn">\n                <span class="continue-reading-text">Continue reading</span>\n                <div class="continue-reading-arrow">\n                  <svg width="15" height="15" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M6 9L12 15L18 9" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                  </svg>\n                </div>\n              </button>\n            </div>\n          ')}});var f=c||!m;l+="\n          ".concat(e.readOnly?'\n          <div class="form-modal-readonly-note">\n            <div class="form-modal-readonly-icon">\n              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n                <path d="M12 16V12M12 8H12.01" stroke="#6f00ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n            </div>\n            <div class="form-modal-readonly-content">\n              <p class="form-modal-readonly-title">Read-Only View</p>\n              <p class="form-modal-readonly-text">You can edit your answers in the review step at the end of the application.</p>\n            </div>\n          </div>\n          ':'\n          <div class="form-modal-finish-wrapper" style="'.concat(f?"":"display: none;",'">\n            <button class="form-modal-finish-btn" data-form-id="').concat(e.formId,'">').concat(r?"Save Changes":"Finish","</button>\n          </div>\n          "),"\n          </div>\n        </div>\n      </div>\n    "),o.innerHTML=l,this.shadowRoot.appendChild(o),this.applyTruncationState(o,!c&&m);var y=this.shadowRoot.querySelector(".bubble-container.loading-message");y&&y.remove();var g=o.querySelector(".form-modal-close");if(g&&g.addEventListener("click",function(){n.closeFormModal(e.formId)}),!e.readOnly){var b=o.querySelector(".form-modal-finish-btn");b&&(b.disabled=!1,b.addEventListener("click",function(){n.submitFormModal(e)}))}e.scrollToQuestionId&&setTimeout(function(){var t=o.querySelector('.form-modal-question[data-question-id="'.concat(e.scrollToQuestionId,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"center"})},300),c||window.requestAnimationFrame(function(){var e=o.querySelector("#continue-reading-all-btn");if(e){var t=!1;e.addEventListener("click",function(s){s.stopPropagation();var i=e.querySelector(".continue-reading-arrow"),a=o.querySelector(".form-modal-finish-btn");t?(n.collapseFormContent(o,e,i,a),t=!1):(n.expandFormContent(o,e,i,a),t=!0)})}}),window.requestAnimationFrame(function(){i&&Array.isArray(i)&&0!==i.length&&i.forEach(function(e){var t=o.querySelector('[data-question-id="'.concat(e.id,'"]'));t&&t.querySelectorAll('input[type="radio"]').forEach(function(e){e.addEventListener("change",function(){if(t.querySelectorAll(".form-modal-check-circle").forEach(function(e){e.classList.remove("checked");var t=e.querySelector("svg");if(t){var n=t.querySelector("path:last-child");n&&"M9 12L11 14L15 10"===n.getAttribute("d")&&n.remove()}}),e.checked){var n=e.closest("label").querySelector(".form-modal-check-circle");if(n){n.classList.add("checked");var o=n.querySelector("svg");if(o){var s=o.querySelector("path:last-child");if(!s||"M9 12L11 14L15 10"!==s.getAttribute("d")){var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M9 12L11 14L15 10"),i.setAttribute("stroke","currentColor"),i.setAttribute("stroke-width","2"),i.setAttribute("stroke-linecap","round"),i.setAttribute("stroke-linejoin","round"),o.appendChild(i)}}}}})})})}),o.addEventListener("click",function(t){t.target===o&&n.closeFormModal(e.formId)});var w=o.querySelector(".form-modal-container");w&&w.addEventListener("click",function(e){e.stopPropagation()})}},{key:"closeFormModal",value:function(e){var t=this.shadowRoot.querySelector("#form-modal-".concat(e));t&&(this.enableFormModalButtons(t),t.remove(),this.enableReviewButtons(),this.unlockBodyScroll())}},{key:"submitFormModal",value:function(e){var t=this.shadowRoot.querySelector("#form-modal-".concat(e.formId));if(t){var n={},o=e.items.filter(function(e){return"QUESTION"===e.type}),s=!1,i=[];if(o.forEach(function(e){if(e.questionOptions&&e.questionOptions.length>0){var o=t.querySelector('input[name="question_'.concat(e.id,'"]:checked'));o?n[e.id]=o.value:e.required?(i.push(e.question||"This question"),s=!0):n[e.id]="skip"}else{var a=t.querySelector('.form-modal-text-input[data-question-id="'.concat(e.id,'"]'));if(a){var r=a.value.trim();e.required&&!r?(i.push(e.question||"This question"),s=!0):n[e.id]=r||"skip"}else e.required?(i.push(e.question||"This question"),s=!0):n[e.id]="skip"}}),s){this.enableFormModalButtons(t);var a=i.length>0?"Please answer the following required question(s):\n".concat(i.join("\n")):"Please answer all required questions";alert(a)}else{if(0===Object.keys(n).length)return this.enableFormModalButtons(t),void alert("No answers collected. Please try again.");var r={formId:e.formId,formStateKey:e.formStateKey,answers:n,action:"submit_form",isEditMode:e.isEditMode||!1};this.closeFormModal(e.formId),this.sendMessage(JSON.stringify(r))}}else console.error("Modal not found for form:",e.formId)}},{key:"disableReviewButtons",value:function(){var e=this.shadowRoot.querySelector(".form-review-container");if(e){var t=e.querySelectorAll(".form-review-edit-btn"),n=e.querySelector(".submit-application-btn");if(t.forEach(function(e){var t=e.disabled||e.hasAttribute("disabled");e.setAttribute("data-originally-disabled",t?"true":"false"),e.disabled=!0,e.style.opacity="0.5",e.style.cursor="not-allowed"}),n){var o=n.disabled||n.hasAttribute("disabled");n.setAttribute("data-originally-disabled",o?"true":"false"),n.disabled=!0,n.style.opacity="0.5",n.style.cursor="not-allowed"}}}},{key:"enableReviewButtons",value:function(){var e=this.shadowRoot.querySelector(".form-review-container");if(e){var t=e.querySelectorAll(".form-review-edit-btn"),n=e.querySelector(".submit-application-btn");if(t.forEach(function(e){"true"===e.getAttribute("data-originally-disabled")?(e.style.opacity="",e.style.cursor=""):(e.disabled=!1,e.removeAttribute("disabled"),e.style.opacity="1",e.style.cursor="pointer"),e.removeAttribute("data-originally-disabled")}),n)"true"===n.getAttribute("data-originally-disabled")?(n.style.opacity="",n.style.cursor=""):(n.disabled=!1,n.removeAttribute("disabled"),n.style.opacity="1",n.style.cursor="pointer"),n.removeAttribute("data-originally-disabled")}}},{key:"disableFormModalButtons",value:function(e){if(e){var t=e.querySelector(".form-modal-finish-btn"),n=e.querySelector(".form-modal-close");t&&(t.disabled=!0,t.style.opacity="0.5",t.style.cursor="not-allowed",t.setAttribute("data-originally-disabled",t.hasAttribute("disabled")?"true":"false")),n&&(n.disabled=!0,n.style.opacity="0.5",n.style.cursor="not-allowed",n.setAttribute("data-originally-disabled",n.hasAttribute("disabled")?"true":"false"))}}},{key:"enableFormModalButtons",value:function(e){if(e){var t=e.querySelector(".form-modal-finish-btn"),n=e.querySelector(".form-modal-close");if(t)"true"===t.getAttribute("data-originally-disabled")||(t.disabled=!1,t.style.opacity="1",t.style.cursor="pointer"),t.removeAttribute("data-originally-disabled");if(n)"true"===n.getAttribute("data-originally-disabled")||(n.disabled=!1,n.style.opacity="1",n.style.cursor="pointer"),n.removeAttribute("data-originally-disabled")}}},{key:"showFormEditSuccess",value:function(e){var t='âœ“ Changes to "'.concat(e||"form",'" have been saved successfully'),n=document.createElement("div");if(n.className="form-edit-success-message",n.textContent=t,n.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #10B981;\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n      z-index: 10000;\n      font-size: 14px;\n      font-weight: 500;\n      animation: slideIn 0.3s ease-out;\n    ",!document.getElementById("form-edit-success-styles")){var o=document.createElement("style");o.id="form-edit-success-styles",o.textContent="\n        @keyframes slideIn {\n          from {\n            transform: translateX(100%);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(0);\n            opacity: 1;\n          }\n        }\n        @keyframes slideOut {\n          from {\n            transform: translateX(0);\n            opacity: 1;\n          }\n          to {\n            transform: translateX(100%);\n            opacity: 0;\n          }\n        }\n      ",document.head.appendChild(o)}(this.shadowRoot||document.body).appendChild(n),setTimeout(function(){n.style.animation="slideOut 0.3s ease-out",setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n)},300)},3e3)}},{key:"loadCssWithRemToEm",value:(r=(0,a.Z)(m().mark(function e(t){var n,o,s,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors"});case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("Failed to fetch CSS: ".concat(n.status));case 5:return e.next=7,n.text();case 7:o=e.sent,s=o.replace(/(-?\d*\.?\d+)rem\b/g,"$1em"),(i=document.createElement("style")).textContent=s,this.shadowRoot.appendChild(i);case 12:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}]),t}(window.HTMLElement);window.customElements.get("dalia-apply-web")||window.customElements.define("dalia-apply-web",x)}}]);